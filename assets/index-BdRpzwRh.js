(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();let F=class{static async hashPassword(e){const o=new TextEncoder().encode(e+"salt_cloud_notes_2026"),i=await crypto.subtle.digest("SHA-512",o);return Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}static async deriveKey(e,n){const o=new TextEncoder,i=await crypto.subtle.importKey("raw",o.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:o.encode(n),iterations:25e4,hash:"SHA-512"},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(e,n){try{const o=crypto.getRandomValues(new Uint8Array(16)),i=crypto.getRandomValues(new Uint8Array(12)),a=await this.deriveKey(n,this.bufToHex(o)),r=new TextEncoder,s=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},a,r.encode(typeof e=="string"?e:JSON.stringify(e)));return{payload:this.bufToHex(new Uint8Array(s)),iv:this.bufToHex(i),salt:this.bufToHex(o)}}catch(o){throw console.error("Encryption failed",o),o}}static async decrypt(e,n){try{const{payload:o,iv:i,salt:a}=e,r=await this.deriveKey(n,a),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:this.hexToBuf(i)},r,this.hexToBuf(o)),d=new TextDecoder().decode(s);try{return JSON.parse(d)}catch{return d}}catch(o){throw console.error("Decryption failed. Wrong password?",o),o}}static bufToHex(e){return Array.from(new Uint8Array(e)).map(n=>n.toString(16).padStart(2,"0")).join("")}static hexToBuf(e){return new Uint8Array(e.match(/.{1,2}/g).map(n=>parseInt(n,16)))}};const u={notes:[],categories:[],settings:{theme:"dark",drivePath:"/backup/notes/",algo:"aes-256-gcm"},currentView:"all",editingNoteId:null,unlockedNotes:new Set,unlockedCategories:new Set,gapiLoaded:!1,tokenClient:null};async function X(){const t=sessionStorage.getItem("cn_pass_plain_v3");if(t){const e=await F.encrypt(u.notes,t),n=await F.encrypt(u.categories,t);localStorage.setItem("cn_notes_v3_enc",JSON.stringify(e)),localStorage.setItem("cn_categories_v3_enc",JSON.stringify(n)),localStorage.removeItem("cn_notes_v3"),localStorage.removeItem("cn_categories_v3")}localStorage.setItem("cn_settings_v3",JSON.stringify(u.settings))}async function Ut(t){try{const e=localStorage.getItem("cn_notes_v3_enc"),n=localStorage.getItem("cn_categories_v3_enc");if(e)u.notes=await F.decrypt(JSON.parse(e),t);else{const o=localStorage.getItem("cn_notes_v3");o&&(u.notes=JSON.parse(o))}if(n)u.categories=await F.decrypt(JSON.parse(n),t);else{const o=localStorage.getItem("cn_categories_v3");o&&(u.categories=JSON.parse(o))}}catch(e){throw console.error("Failed to load encrypted data",e),e}}function vn(){const t=localStorage.getItem("cn_settings_v3");t&&(u.settings={...u.settings,...JSON.parse(t)})}const bn="v3.3.4",je=[{id:"default",light:"#ffffff",dark:"#09090b"},{id:"red",light:"#fef2f2",dark:"#450a0a"},{id:"orange",light:"#fff7ed",dark:"#431407"},{id:"yellow",light:"#fefce8",dark:"#422006"},{id:"green",light:"#f0fdf4",dark:"#064e3b"},{id:"teal",light:"#f0fdfa",dark:"#134e4a"},{id:"blue",light:"#eff6ff",dark:"#1e3a8a"},{id:"darkblue",light:"#eef2ff",dark:"#1e1b4b"},{id:"purple",light:"#faf5ff",dark:"#3b0764"},{id:"pink",light:"#fdf2f8",dark:"#500724"},{id:"brown",light:"#fffaf5",dark:"#2d1a10"},{id:"gray",light:"#f8fafc",dark:"#0f172a"}],Jt=["#ffffff","#f28b82","#fbbc04","#fff475","#ccff90","#a7ffeb","#cbf0f8","#aecbfa","#d7aefb","#fdcfe8","#e6c9a8","#e8eaed","#1e293b","#450a0a","#422006","#064e3b","#134e4a","#1e3a8a","#1e1b4b","#4c1d95","#500724","#27272a","#09090b","#000000"],yn=["üòä","üòÇ","ü•∞","üòé","ü§î","üò¥","üî•","‚ú®","üöÄ","üéâ","‚ù§Ô∏è","üëç","üí°","üìÖ","‚úÖ","‚ùå","üîí","üîë","üìå","üé®","üìÅ","üè†","üåü","üåç","üíª","üì±","üçé","üçï","üç∫","üåà","‚òÄÔ∏è","üåô","‚ö°","üíé","üéÅ","üéà","üéµ","üì∑","üîç","üõ∏","üëæ","ü§ñ","üëª","ü¶Ñ","üêæ","üèÄ","‚öΩ","üöó","‚úàÔ∏è","üïπÔ∏è","üéÆ","üé≤","üß©","üé≠","üé¨","üé§","üéß","üéπ","üé∏","üéª","üé∫","üé∑","ü•Å","üèπ","üé£","üöµ","üßó","üßò","üõÅ","üõå","üóùÔ∏è","üõ°Ô∏è","‚öîÔ∏è","üó∫Ô∏è","üïØÔ∏è","‚åõ","‚öñÔ∏è","‚öôÔ∏è","‚öíÔ∏è","üõ†Ô∏è","‚õèÔ∏è","‚õìÔ∏è","üî≠","üî¨","üíä","üíâ","üß¨","ü©∏","üß™","üå°Ô∏è","üß¥","üßπ","üß∫","üßº","üßΩ","ü™£","ü™í","üßª","üõÄ","üöø","üöΩ"];function T(t,e=3e3){const n=document.getElementById("toast");n&&(n.querySelector("div").innerText=t,n.classList.add("show"),setTimeout(()=>n.classList.remove("show"),e))}function be(t,e,n=!0){return new Promise(o=>{const i=document.getElementById("prompt-modal"),a=document.getElementById("prompt-input");if(!i||!a)return o(null);document.getElementById("prompt-title").innerText=t,document.getElementById("prompt-desc").innerText=e,a.type=n?"password":"text",a.value="",i.classList.remove("hidden"),K(),a.focus();const r=()=>{i.classList.add("hidden"),window.removeEventListener("keydown",s)},s=p=>{p.key==="Enter"&&l(),p.key==="Escape"&&d()};window.addEventListener("keydown",s);const l=()=>{const p=a.value;r(),o(p)},d=()=>{r(),o(null)};document.getElementById("prompt-confirm").onclick=l,document.getElementById("prompt-cancel").onclick=d})}function wn(t){if(!t)return!0;const e=t.replace("#",""),n=parseInt(e.substr(0,2),16),o=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16);return isNaN(n)||isNaN(o)||isNaN(i)?!0:(n*299+o*587+i*114)/1e3<128}function K(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}class xn{constructor(e="chunk_",n="/backup/notes/"){this.basePath=n,this.dbPrefix=e,this.chunkSizeLimit=100*1024}async getOrCreateFolder(e){const n=e.split("/").filter(i=>i);let o="root";for(const i of n){const a=`name = '${i}' and mimeType = 'application/vnd.google-apps.folder' and '${o}' in parents and trashed = false`,s=(await gapi.client.drive.files.list({q:a,fields:"files(id, name)"})).result.files;if(s.length>0)o=s[0].id;else{const l={name:i,mimeType:"application/vnd.google-apps.folder",parents:[o]};o=(await gapi.client.drive.files.create({resource:l,fields:"id"})).result.id}}return o}async saveChunks(e,n){const o=JSON.stringify(e),i=[];for(let a=0;a<o.length;a+=this.chunkSizeLimit)i.push(o.substring(a,a+this.chunkSizeLimit));for(let a=0;a<i.length;a++){const r=`${this.dbPrefix}${a}.json`;await this.uploadFile(r,i[a],n)}return i.length}async uploadFile(e,n,o){const i=`name = '${e}' and '${o}' in parents and trashed = false`,r=(await gapi.client.drive.files.list({q:i,fields:"files(id)"})).result.files,s=r.length>0?r[0].id:null,l={name:e,parents:s?[]:[o]},d=new Blob([n],{type:"application/json"}),p=gapi.auth.getToken().access_token,c=s?"PATCH":"POST",g=s?`https://www.googleapis.com/upload/drive/v3/files/${s}?uploadType=media`:"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart";if(s)await fetch(g,{method:c,headers:{Authorization:`Bearer ${p}`},body:d});else{const v=new FormData;v.append("metadata",new Blob([JSON.stringify(l)],{type:"application/json"})),v.append("file",d),await fetch(g,{method:c,headers:{Authorization:`Bearer ${p}`},body:v})}}async loadChunks(e){const n=`name contains '${this.dbPrefix}' and '${e}' in parents and trashed = false`,i=(await gapi.client.drive.files.list({q:n,fields:"files(id, name)",orderBy:"name"})).result.files;let a="";for(const r of i){const s=await gapi.client.drive.files.get({fileId:r.id,alt:"media"});a+=typeof s.result=="string"?s.result:JSON.stringify(s.result)}return a?JSON.parse(a):null}}function En(){return`
    <div id="auth-shield" class="fixed inset-0 z-[100] flex items-center justify-center bg-background/95 backdrop-blur-sm transition-opacity duration-300">
        <div class="w-full max-w-sm p-8 space-y-6 bg-card border rounded-lg shadow-lg">
            <div class="text-center space-y-2">
                <div class="mx-auto w-10 h-10 bg-primary rounded-md flex items-center justify-center text-primary-foreground">
                    <i data-lucide="lock" class="w-5 h-5"></i>
                </div>
                <h1 class="text-2xl font-semibold tracking-tight" id="auth-title">B√≥veda Protegida</h1>
                <p class="text-sm text-muted-foreground" id="auth-desc">Ingresa tu contrase√±a maestra para continuar</p>
            </div>
            <div class="space-y-4">
                <div class="relative">
                    <input type="password" id="master-password" placeholder="Tu contrase√±a" class="text-center tracking-widest pr-10">
                    <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground toggle-pass" data-target="master-password">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="relative hidden" id="confirm-password-wrapper">
                    <input type="password" id="confirm-password" placeholder="Repite la contrase√±a" class="text-center tracking-widest pr-10">
                    <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground toggle-pass" data-target="confirm-password">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <button id="auth-submit" class="btn-shad btn-shad-primary w-full">Desbloquear</button>
            </div>
        </div>
    </div>`}async function Sn(t){const e=document.getElementById("auth-shield"),n=!localStorage.getItem("cn_master_hash_v3"),o=sessionStorage.getItem("cn_pass_plain_v3");n?In():o?await F.hashPassword(o)===localStorage.getItem("cn_master_hash_v3")?(e.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>e.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),await Ut(o),t()):(sessionStorage.removeItem("cn_pass_plain_v3"),Mt()):Mt()}function In(){const t=document.getElementById("auth-title"),e=document.getElementById("auth-desc"),n=document.getElementById("confirm-password-wrapper"),o=document.getElementById("auth-submit");t&&(t.innerText="Configura tu B√≥veda"),e&&(e.innerText="Crea una contrase√±a maestra. Introduce la contrase√±a dos veces para asegurar que es correcta."),n&&n.classList.remove("hidden"),o&&(o.innerText="Crear mi B√≥veda",o.classList.remove("btn-shad-primary"),o.classList.add("btn-shad-success"))}function Mt(){const t=document.getElementById("auth-title"),e=document.getElementById("auth-desc"),n=document.getElementById("confirm-password-wrapper"),o=document.getElementById("auth-submit");t&&(t.innerText="B√≥veda Protegida"),e&&(e.innerText="Ingresa tu contrase√±a maestra para continuar"),n&&n.classList.add("hidden"),o&&(o.innerText="Desbloquear",o.classList.add("btn-shad-primary"),o.classList.remove("btn-shad-success"))}async function _n(t){const e=document.getElementById("master-password").value,n=document.getElementById("confirm-password").value,o=!localStorage.getItem("cn_master_hash_v3");if(!e)return T("Ingresa una contrase√±a");if(o){if(!n)return T("Confirma tu contrase√±a");if(e!==n)return T("‚ö†Ô∏è ¬°Las contrase√±as no coinciden!");if(e.length<4)return T("La contrase√±a debe tener al menos 4 caracteres")}const i=await F.hashPassword(e),a=localStorage.getItem("cn_master_hash_v3");if(!a)localStorage.setItem("cn_master_hash_v3",i),sessionStorage.setItem("cn_pass_plain_v3",e),T("‚úÖ B√≥veda creada con √©xito");else if(a===i)sessionStorage.setItem("cn_pass_plain_v3",e),T("B√≥veda abierta");else return T("‚ùå Contrase√±a incorrecta");const r=document.getElementById("auth-shield");r.classList.add("opacity-0","pointer-events-none"),setTimeout(()=>r.style.display="none",300),document.getElementById("app").classList.remove("opacity-0"),await Ut(e),t()}function kn(){return`
    <div id="app" class="flex h-screen overflow-hidden opacity-100 transition-opacity duration-300">
        <!-- Sidebar Desktop -->
        <aside class="w-64 hidden md:flex flex-col border-r bg-sidebar">
            <style>
                @keyframes logo-rainbow {
                    0% { color: #6366f1; filter: drop-shadow(0 0 2px #6366f1); }
                    33% { color: #ec4899; filter: drop-shadow(0 0 2px #ec4899); }
                    66% { color: #10b981; filter: drop-shadow(0 0 2px #10b981); }
                    100% { color: #6366f1; filter: drop-shadow(0 0 2px #6366f1); }
                }
                .logo-animate { animation: logo-rainbow 8s infinite linear; }
            </style>
            <div class="p-6 flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 p-2 flex items-center justify-center border border-primary/20 shadow-inner">
                    <svg viewBox="0 0 24 24" fill="none" class="w-full h-full logo-animate" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-sm font-bold tracking-tight bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent">Private Notes</h1>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto px-4 space-y-8">
                <div class="space-y-1">
                    <button class="nav-link active w-full" data-view="all">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> Todas las notas
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="flex items-center justify-between px-4" id="sidebar-categories-header">
                        <h3 class="sidebar-section-title text-[11px] font-bold text-muted-foreground uppercase tracking-wider">Etiquetas</h3>
                    </div>
                    <div id="sidebar-categories" class="space-y-1"></div>
                </div>
            </div>

            <div class="p-6 space-y-2 mt-auto">
                <button id="sidebar-manage-cats" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="tag" class="w-3.5 h-3.5"></i> Gestionar Etiquetas
                </button>
                <button id="settings-trigger" class="nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="settings" class="w-3.5 h-3.5"></i> Preferencias
                </button>
                <button id="sidebar-pwa-install-btn" class="hidden nav-link w-full text-xs opacity-60 hover:opacity-100">
                    <i data-lucide="download" class="w-3.5 h-3.5"></i> Instalar Aplicaci√≥n
                </button>
                <button id="logout-btn" class="nav-link w-full text-xs opacity-60 hover:opacity-100 text-destructive">
                    <i data-lucide="log-out" class="w-3.5 h-3.5"></i> Cerrar B√≥veda
                </button>
                <div class="mt-auto pt-4 border-t border-border/20 px-4">
                    <div id="app-version" class="text-[9px] text-muted-foreground font-mono opacity-30">v3.3.4</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-background relative overflow-hidden h-full">
            <!-- Desktop Header -->
            <header class="hidden md:flex h-16 items-center justify-between px-8 border-b">
                <div class="flex items-center gap-4 flex-1">
                    <div class="relative w-full max-w-sm">
                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="search-input" placeholder="Buscar notas..." class="pl-12 h-9 w-full" autocomplete="off">
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="sync-btn" class="p-2 hover:bg-accent rounded-md text-muted-foreground transition-colors" title="Sincronizar ahora">
                        <i data-lucide="refresh-cw" class="w-5 h-5" id="sync-icon"></i>
                    </button>
                    <button id="pwa-install-btn" class="hidden btn-shad btn-shad-outline h-9 px-3">
                        <i data-lucide="download" class="w-4 h-4 mr-2"></i> Instalar
                    </button>
                    <button id="add-note-btn" class="btn-shad btn-shad-primary h-9">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i> Nueva Nota
                    </button>
                </div>
            </header>

            <!-- Mobile Top Bar -->
            <div class="md:hidden h-14 border-b flex items-center justify-between px-4 bg-background/80 backdrop-blur-xl sticky top-0 z-50">
                <div class="flex items-center gap-3">
                    <button id="mobile-sidebar-trigger" class="p-2 -ml-2 hover:bg-accent rounded-md">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                    <div class="flex items-center gap-2">
                        <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-primary/20 to-primary/5 p-1 flex items-center justify-center border border-primary/20 shadow-inner">
                            <svg viewBox="0 0 24 24" fill="none" class="w-full h-full text-primary" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                        </div>
                        <span class="font-bold tracking-tight text-lg">Private Notes</span>
                    </div>
                </div>
                <div class="flex items-center gap-1">
                    <button id="mobile-search-btn" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="mobile-search-bar" class="absolute inset-0 bg-background flex items-center px-4 gap-2 hidden animate-in slide-in-from-top duration-200">
                    <i data-lucide="search" class="w-4 h-4 text-muted-foreground"></i>
                    <input type="text" id="mobile-search-input-top" placeholder="Buscar en tus notas..." class="flex-1 bg-transparent border-none outline-none text-sm h-full" autocomplete="off">
                    <button id="close-mobile-search" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Grid -->
            <div id="notes-viewport" class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8">
                <div class="max-w-7xl mx-auto space-y-8">
                    <div class="flex items-end justify-between">
                        <div>
                            <h1 id="view-title" class="text-3xl font-bold tracking-tight">Todas las notas</h1>
                            <p id="view-desc" class="text-sm text-muted-foreground mt-1">Organiza tus pensamientos y protege tu privacidad.</p>
                        </div>
                    </div>
                    <div id="notes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- Mobile Bottom Nav -->
            <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-background/90 backdrop-blur-2xl border-t flex items-center justify-around z-40 pb-safe">
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors nav-link-mobile" data-view="all">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    <span class="text-[10px] font-medium">Inicio</span>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-search-trigger">
                    <i data-lucide="search" class="w-5 h-5"></i>
                    <span class="text-[10px] font-medium">Buscar</span>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-add-btn">
                    <div class="w-10 h-10 bg-primary text-primary-foreground rounded-full flex items-center justify-center shadow-lg hover:scale-105 transition-transform">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </div>
                </button>
                <button class="flex flex-col items-center justify-center gap-1 w-full h-full text-muted-foreground active:text-primary transition-colors" id="mobile-menu-trigger">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                    <span class="text-[10px] font-medium">Men√∫</span>
                </button>
            </nav>
        </main>

        <!-- Mobile Sidebar Drawer -->
        <div id="mobile-sidebar-overlay" class="fixed inset-0 bg-background/80 backdrop-blur-sm z-[100] hidden">
            <div id="mobile-sidebar-drawer" class="w-[80vw] h-full bg-card border-r flex flex-col animate-in slide-in-from-left duration-300">
                <div class="p-6 flex items-center justify-between border-b">
                    <div class="flex items-center gap-2">
                        <div class="w-6 h-6 rounded-md bg-gradient-to-br from-primary/20 to-primary/5 p-1 flex items-center justify-center border border-primary/20 shadow-inner">
                            <svg viewBox="0 0 24 24" fill="none" class="w-full h-full text-primary" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                        </div>
                        <span class="font-bold tracking-tight">Private Notes</span>
                    </div>
                    <button id="close-mobile-sidebar" class="p-2 hover:bg-accent rounded-md">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-8">
                    <div class="space-y-1">
                        <button class="nav-link-mobile-drawer active w-full" data-view="all">
                            <i data-lucide="layout-grid" class="w-4 h-4"></i> Todas las notas
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2" id="mobile-sidebar-categories-header">
                            <h3 class="sidebar-section-title">Etiquetas</h3>
                        </div>
                        <div id="mobile-sidebar-categories" class="space-y-1 px-2"></div>
                    </div>
                </div>
                <div class="p-6 border-t space-y-2">
                    <button id="mobile-manage-cats" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="tag" class="w-4 h-4"></i> Gestionar Etiquetas
                    </button>
                    <button id="mobile-sync-btn" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> Sincronizar
                    </button>
                    <button id="mobile-logout-btn" class="flex items-center gap-3 w-full p-3 rounded-md hover:bg-accent text-sm text-destructive">
                        <i data-lucide="log-out" class="w-4 h-4"></i> Cerrar B√≥veda
                    </button>
                </div>
            </div>
        </div>
    </div>`}let yt=null;function Tn(){return`
    <div id="editor-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-background/80 backdrop-blur-sm dialog-overlay"></div>
        <div class="dialog-content max-w-2xl h-[80vh] flex flex-col">
            <div class="flex items-center justify-between border-b pb-4">
                <input type="text" id="edit-title" placeholder="T√≠tulo de la nota"
                    class="bg-transparent text-xl font-bold outline-none border-none placeholder:text-muted-foreground w-full">
                <button id="close-editor" class="text-muted-foreground hover:text-foreground"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div class="flex-1 py-4 overflow-y-auto">
                <div class="flex items-center gap-1 mb-4 p-1 border rounded-md bg-muted/30 w-fit">
                    <button class="editor-tool" data-cmd="bold"><i data-lucide="bold" class="w-4 h-4"></i></button>
                    <button id="open-text-colors" class="editor-tool" title="Color de texto"><i data-lucide="type" class="w-4 h-4"></i></button>
                    <div class="w-px h-4 bg-border mx-1"></div>
                    <button class="editor-tool" data-cmd="italic"><i data-lucide="italic" class="w-4 h-4"></i></button>
                    <button class="editor-tool" data-cmd="underline"><i data-lucide="underline" class="w-4 h-4"></i></button>
                    <div class="w-px h-4 bg-border mx-1"></div>
                    <button id="open-emojis" class="editor-tool"><i data-lucide="smile" class="w-4 h-4"></i></button>
                </div>

                <div id="edit-content" contenteditable="true"
                    class="min-h-[200px] outline-none text-sm leading-relaxed prose prose-slate dark:prose-invert max-w-none"
                    placeholder="Empieza a escribir..."></div>
            </div>

            <div class="border-t pt-4 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="flex items-center bg-muted/30 p-1 rounded-md border mr-2">
                        <button id="open-colors" class="editor-tool" title="Color de fondo"><i data-lucide="palette" class="w-4 h-4"></i></button>
                    </div>

                    <div class="relative group" id="cat-select-wrapper">
                        <button id="cat-dropdown-trigger"
                            class="h-9 px-3 rounded-md border border-input bg-background/50 text-xs flex items-center gap-2 hover:bg-accent transition-all">
                            <span id="selected-cat-label">Sin categor√≠a</span>
                            <i data-lucide="chevron-down" class="w-3 h-3 text-muted-foreground"></i>
                        </button>
                        <div id="cat-dropdown-menu"
                            class="absolute bottom-full mb-2 left-0 w-48 bg-popover border rounded-md shadow-xl hidden z-50 py-1 overflow-hidden">
                        </div>
                        <select id="edit-category" class="hidden">
                            <option value="">Sin categor√≠a</option>
                        </select>
                    </div>
                    <button id="toggle-pin" class="h-9 w-9 inline-flex items-center justify-center rounded-md border border-input bg-background/50 hover:bg-accent transition-all">
                        <i data-lucide="pin" class="w-4 h-4"></i>
                    </button>
                    <button id="toggle-lock" class="h-9 w-9 inline-flex items-center justify-center rounded-md border border-input bg-background/50 hover:bg-accent transition-all">
                        <i data-lucide="lock" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="flex gap-2">
                    <button id="delete-note" class="btn-shad bg-destructive/10 text-destructive hover:bg-destructive hover:text-white h-9 px-3" title="Eliminar nota">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                    <button id="save-note" class="btn-shad btn-shad-primary h-9">Guardar Nota</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Popovers -->
    <div id="color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="bg-color-grid"></div>
    </div>
    <div id="text-color-popover" class="fixed z-[60] hidden popover-content">
        <div class="grid grid-cols-6 gap-2" id="text-color-grid"></div>
    </div>
    <div id="emoji-popover" class="fixed z-[60] hidden popover-content w-80">
        <div class="grid grid-cols-8 gap-2 h-64 overflow-y-auto" id="emoji-grid"></div>
    </div>`}function Cn(t){document.getElementById("editor-modal"),document.getElementById("edit-title");const e=document.getElementById("edit-content"),n=document.getElementById("close-editor"),o=document.getElementById("save-note"),i=document.getElementById("delete-note");n.onclick=wt,o.onclick=async()=>{await Dn(),t()},i.onclick=async()=>{u.editingNoteId&&confirm("¬øEliminar esta nota?")&&(u.notes=u.notes.filter(a=>a.id!==u.editingNoteId),await X(),wt(),t())},document.querySelectorAll(".editor-tool").forEach(a=>{a.dataset.cmd&&(a.onmousedown=r=>{r.preventDefault(),xt(),document.execCommand(a.dataset.cmd,!1,a.dataset.val||null),Re()})}),Nn(),e.onkeyup=()=>{Pe(),Re()},e.onmouseup=()=>{Pe(),Re()},e.onfocus=()=>{Pe(),Re()}}function Re(){document.querySelectorAll(".editor-tool[data-cmd]").forEach(t=>{const e=t.dataset.cmd,n=document.queryCommandState(e);t.classList.toggle("bg-primary/20",n),t.classList.toggle("text-primary",n)})}function Ne(t=null){const e=document.getElementById("editor-modal"),n=document.getElementById("edit-title"),o=document.getElementById("edit-content"),i=document.getElementById("edit-category"),a=e.querySelector(".dialog-content");u.editingNoteId=t?t.id:null,n.value=(t==null?void 0:t.title)||"",o.innerHTML=(t==null?void 0:t.content)===void 0||(t==null?void 0:t.content)==="undefined"?"":(t==null?void 0:t.content)||"";let r="";!t&&u.currentView!=="all"&&(r=u.currentView),i.value=t?t.categoryId||"":r;const s=je.find(c=>c.id===(t?t.themeId:"default"))||je[0],l=u.settings.theme==="dark"?s.dark:s.light,d=s.id==="default"?u.settings.theme==="dark":wn(l);a.style.backgroundColor=l,a.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",a.dataset.themeId=s.id,n.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",o.style.color=d?"rgba(255,255,255,0.95)":"rgba(0,0,0,0.9)",e.querySelectorAll(".editor-tool, #cat-dropdown-trigger, #toggle-pin, #toggle-lock").forEach(c=>{c.style.color=d?"rgba(255,255,255,0.7)":"rgba(0,0,0,0.7)",c.style.borderColor=d?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",c.style.backgroundColor=d?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)"}),Kt(t?t.pinned:!1),Et(t?!!t.passwordHash:!1),Bn(),e.classList.remove("hidden"),o.focus()}function wt(){document.getElementById("editor-modal").classList.add("hidden"),document.getElementById("toggle-lock").dataset.tempHash="",u.editingNoteId=null}async function Dn(){let t=document.getElementById("edit-title").value.trim();const e=document.getElementById("edit-content").innerHTML,n=document.getElementById("edit-category").value,o=document.getElementById("toggle-pin").dataset.active==="true",i=document.getElementById("toggle-lock").dataset.active==="true",a=document.querySelector("#editor-modal .dialog-content").dataset.themeId;if(!t){const d=new Date;t=d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")+", "+String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")+":"+String(d.getSeconds()).padStart(2,"0")}if(e===void 0||e==="undefined"||e.trim()==="")return T("La nota est√° vac√≠a");const r=u.notes.findIndex(d=>d.id===u.editingNoteId),s=document.getElementById("toggle-lock").dataset.tempHash,l={id:u.editingNoteId||Date.now().toString(),title:t,content:e,categoryId:n||null,pinned:o,themeId:a||"default",passwordHash:i?s||(r>=0?u.notes[r].passwordHash:null):null,updatedAt:Date.now()};if(i&&!l.passwordHash){const d=await be("Seguridad","Establece una contrase√±a para esta nota:");if(d)l.passwordHash=await F.hashPassword(d);else return}r>=0?u.notes[r]=l:u.notes.unshift(l),await X(),wt(),window.triggerAutoSync&&window.triggerAutoSync()}function Pe(){const t=window.getSelection();t.rangeCount>0&&(yt=t.getRangeAt(0))}function xt(){if(yt){const t=window.getSelection();t.removeAllRanges(),t.addRange(yt)}}function Bn(){const t=document.getElementById("edit-category").value,e=u.categories.find(n=>n.id===t);document.getElementById("selected-cat-label")&&(document.getElementById("selected-cat-label").innerText=e?e.name:"Sin categor√≠a")}function Kt(t){const e=document.getElementById("toggle-pin");e.dataset.active=t,e.className=t?"h-9 w-9 inline-flex items-center justify-center rounded-md border border-primary bg-primary/20 text-primary shadow-inner":"h-9 w-9 inline-flex items-center justify-center rounded-md border border-input hover:bg-accent text-muted-foreground"}function Et(t){const e=document.getElementById("toggle-lock");e.dataset.active=t,e.className=t?"h-9 w-9 inline-flex items-center justify-center rounded-md border border-primary bg-primary/10 text-primary":"h-9 w-9 inline-flex items-center justify-center rounded-md border border-input hover:bg-accent text-muted-foreground";const n=e.querySelector("[data-lucide]");n&&(n.setAttribute("data-lucide",t?"lock":"lock-open"),K())}function Nn(){document.getElementById("open-colors").onclick=i=>st(i,"color-popover"),document.getElementById("open-text-colors").onmousedown=i=>{i.preventDefault(),Pe()},document.getElementById("open-text-colors").onclick=i=>st(i,"text-color-popover"),document.getElementById("open-emojis").onmousedown=i=>{i.preventDefault(),Pe()},document.getElementById("open-emojis").onclick=i=>st(i,"emoji-popover");const t=document.getElementById("bg-color-grid");je.forEach(i=>{const a=document.createElement("div");a.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",a.style.backgroundColor=u.settings.theme==="dark"?i.dark:i.light,a.onclick=()=>{const r=document.querySelector("#editor-modal .dialog-content");r.style.backgroundColor=u.settings.theme==="dark"?i.dark:i.light,r.dataset.themeId=i.id,Te()},t.appendChild(a)});const e=document.getElementById("text-color-grid");Jt.forEach(i=>{const a=document.createElement("div");a.className="w-8 h-8 rounded-full cursor-pointer border hover:scale-110 transition-transform",a.style.backgroundColor=i,a.onmousedown=r=>r.preventDefault(),a.onclick=()=>{xt(),document.execCommand("foreColor",!1,i),Te()},e.appendChild(a)});const n=document.getElementById("emoji-grid");yn.forEach(i=>{const a=document.createElement("span");a.className="cursor-pointer hover:bg-accent p-2 rounded text-xl text-center",a.innerText=i,a.onclick=()=>{xt(),document.execCommand("insertHTML",!1,i),Te()},n.appendChild(a)}),document.getElementById("toggle-pin").onclick=function(){const i=this.dataset.active!=="true";Kt(i)},document.getElementById("toggle-lock").onclick=async function(){if(this.dataset.active==="true"){if(confirm("¬øQuitar la protecci√≥n de contrase√±a de esta nota?")){const a=u.notes.find(r=>r.id===u.editingNoteId);a&&(a.passwordHash=null),delete this.dataset.tempHash,Et(!1),T("üîì Protecci√≥n quitada")}}else{const a=await be("Proteger Nota","Establece una contrase√±a para esta nota (d√©jala vac√≠a para cancelar):");if(a){const r=u.notes.find(l=>l.id===u.editingNoteId),s=await F.hashPassword(a);r&&(r.passwordHash=s),this.dataset.tempHash=s,Et(!0),T("üîë Contrase√±a establecida")}}},document.addEventListener("click",i=>{!i.target.closest(".editor-tool")&&!i.target.closest(".popover-content")&&!i.target.closest("#cat-dropdown-trigger")&&Te()});const o=document.getElementById("cat-dropdown-trigger");o.onclick=i=>{i.stopPropagation(),document.getElementById("cat-dropdown-menu").classList.toggle("hidden")}}function st(t,e){t.stopPropagation();const n=document.getElementById(e),o=t.currentTarget.getBoundingClientRect();Te(e),n.classList.remove("hidden"),n.style.top=`${o.bottom+8}px`,n.style.left=`${Math.min(o.left,window.innerWidth-300)}px`}function Te(t=null){["color-popover","text-color-popover","emoji-popover","cat-dropdown-menu"].forEach(e=>{const n=document.getElementById(e);e!==t&&n&&n.classList.add("hidden")})}function Pn(){return`
    <div id="categories-modal" class="fixed inset-0 z-[70] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content max-w-lg p-0 overflow-hidden h-[500px] flex flex-col">
            <div class="p-6 flex justify-between items-center border-b">
                <div>
                    <h2 class="text-lg font-semibold text-foreground">Gestionar Etiquetas</h2>
                    <p class="text-xs text-muted-foreground">Organiza tus notas con categor√≠as personalizadas</p>
                </div>
                <button class="close-categories p-2 hover:bg-accent rounded-md transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div class="p-4 bg-muted/30 border-b">
                <div class="flex items-center gap-2">
                    <div class="relative flex-1">
                        <i data-lucide="tag" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                        <input type="text" id="new-cat-name" placeholder="Nueva etiqueta..." 
                               class="pl-12 h-10 w-full bg-background" autocomplete="off">
                    </div>
                    <button id="add-cat-btn" class="btn-shad btn-shad-primary h-10 px-6">Crear</button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-2" id="cat-manager-list">
                <!-- Items injected here -->
            </div>
        </div>
        <!-- Color Picker Popover -->
        <div id="cat-color-picker" class="fixed z-[80] hidden popover-content p-2">
            <div class="grid grid-cols-5 gap-2" id="cat-palette-grid"></div>
        </div>
    </div>`}function $e(t,e=null){const n=document.getElementById("cat-manager-list");n&&(n.innerHTML="",e&&(u.categories=e),u.categories.forEach(o=>{const i=document.createElement("div");i.className="flex items-center gap-3 p-2 rounded-lg border bg-card/50 hover:bg-accent/30 transition-all group",i.innerHTML=`
            <div class="w-8 h-8 rounded-md cursor-pointer hover:scale-110 transition-transform shadow-sm flex-shrink-0 flex items-center justify-center border" 
                 style="background-color: ${o.color};"
                 id="cp-${o.id}" title="Cambiar color">
            </div>
            
            <input type="text" value="${o.name}" 
                   class="bg-transparent border-none outline-none font-medium text-sm flex-1 focus:ring-0 transition-colors h-9 px-2 rounded hover:bg-background/50 focus:bg-background"
                   id="cn-${o.id}" autocomplete="off">
            
            <div class="flex items-center gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                <button class="p-2 rounded-md hover:bg-background border border-transparent hover:border-border transition-all ${o.passwordHash?"text-primary":"text-muted-foreground"}"
                        id="lock-${o.id}" title="${o.passwordHash?"Protegido":"Protecci√≥n"}">
                    <i data-lucide="${o.passwordHash?"lock":"unlock"}" class="w-4 h-4"></i>
                </button>
                <button class="p-2 rounded-md hover:bg-destructive/10 hover:text-destructive text-muted-foreground transition-all"
                        id="del-${o.id}" title="Eliminar">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `,n.appendChild(i),document.getElementById(`cp-${o.id}`).onclick=r=>{r.stopPropagation(),An(o.id,t,r.currentTarget)};const a=document.getElementById(`cn-${o.id}`);a.oninput=r=>{o.name=r.target.value,t()},a.onchange=async()=>{await X(),t()},document.getElementById(`lock-${o.id}`).onclick=()=>On(o.id,t),document.getElementById(`del-${o.id}`).onclick=()=>Ln(o.id,t)}),K())}async function An(t,e,n){const o=u.categories.find(l=>l.id===t);if(!o)return;const i=document.getElementById("cat-color-picker"),a=document.getElementById("cat-palette-grid");a.innerHTML="",Jt.forEach(l=>{const d=document.createElement("div");d.className="w-6 h-6 rounded-md cursor-pointer border hover:scale-110 transition-transform",d.style.backgroundColor=l,d.onclick=async()=>{o.color=l,await X(),$e(e),e(),i.classList.add("hidden")},a.appendChild(d)});const r=n.getBoundingClientRect();i.style.top=`${r.bottom+8}px`,i.style.left=`${r.left}px`,i.classList.remove("hidden");const s=l=>{!i.contains(l.target)&&l.target!==n&&(i.classList.add("hidden"),document.removeEventListener("click",s))};setTimeout(()=>document.addEventListener("click",s),10)}async function Ln(t,e){const n=u.categories.find(o=>o.id===t);if(n){if(n.passwordHash){const o=await be("Seguridad","Etiqueta protegida. Ingresa contrase√±a para eliminar:");if(!o)return;if(await F.hashPassword(o)!==n.passwordHash)return T("‚ùå Error: Contrase√±a incorrecta")}confirm(`¬øEliminar la etiqueta "${n.name}"? Las notas no se borrar√°n.`)&&(u.categories=u.categories.filter(o=>o.id!==t),u.notes.forEach(o=>{o.categoryId===t&&(o.categoryId=null)}),u.currentView===t&&(u.currentView="all"),await X(),$e(e),e())}}async function On(t,e){const n=u.categories.find(o=>o.id===t);if(n){if(n.passwordHash){const o=await be("Seguridad","Ingresa la contrase√±a para quitar la protecci√≥n:");if(!o)return;if(await F.hashPassword(o)!==n.passwordHash)return T("‚ùå Error: Contrase√±a incorrecta");n.passwordHash=null,T("üîì Protecci√≥n quitada")}else{const o=await be("Seguridad","Define una contrase√±a para proteger esta etiqueta:");o&&(n.passwordHash=await F.hashPassword(o),T("üîí Etiqueta protegida"))}await X(),$e(e),e()}}function Mn(){return`
    <div id="settings-modal" class="fixed inset-0 z-[80] hidden">
        <div class="dialog-overlay"></div>
        <div class="dialog-content max-w-2xl p-0 overflow-hidden flex flex-col md:flex-row h-[500px]">
            <!-- Sidebar Settings -->
            <div class="w-full md:w-48 bg-muted/50 border-b md:border-b-0 md:border-r p-4 flex flex-row md:flex-col gap-1 overflow-x-auto md:overflow-x-visible">
                <button class="settings-tab active" data-tab="appearance">
                    <i data-lucide="palette" class="w-4 h-4"></i> Apariencia
                </button>
                <button class="settings-tab" data-tab="sync">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> Sincronizaci√≥n
                </button>
                <button class="settings-tab" data-tab="security">
                    <i data-lucide="shield" class="w-4 h-4"></i> Seguridad
                </button>
                <button class="settings-tab text-destructive mt-auto" data-tab="danger">
                    <i data-lucide="alert-triangle" class="w-4 h-4"></i> Zona Peligrosa
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 flex flex-col min-w-0">
                <div class="p-4 border-b flex justify-between items-center">
                    <h2 id="settings-tab-title" class="font-bold">Configuraci√≥n</h2>
                    <button class="close-settings p-2 hover:bg-accent rounded-md group">
                        <i data-lucide="x" class="w-5 h-5 text-muted-foreground group-hover:text-foreground"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6" id="settings-panels">
                    <!-- Panel: Apariencia -->
                    <div id="panel-appearance" class="settings-panel space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Tema Visual</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button id="theme-light" class="flex flex-col items-center gap-2 p-4 rounded-lg border bg-card hover:bg-accent transition-all group">
                                    <div class="w-full aspect-video bg-zinc-100 rounded border flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-300 rounded"></div>
                                    </div>
                                    <span class="text-xs font-medium">Claro</span>
                                </button>
                                <button id="theme-dark" class="flex flex-col items-center gap-2 p-4 rounded-lg border bg-zinc-950 hover:bg-zinc-900 transition-all group ring-primary">
                                    <div class="w-full aspect-video bg-zinc-800 rounded border border-zinc-700 flex items-center justify-center">
                                         <div class="w-1/2 h-2 bg-zinc-600 rounded"></div>
                                    </div>
                                    <span class="text-xs font-medium text-white">Oscuro</span>
                                </button>
                            </div>
                        </section>
                    </div>

                    <!-- Panel: Sincronizaci√≥n -->
                    <div id="panel-sync" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Google Drive</h3>
                                <span id="drive-status" class="text-[10px] px-2 py-0.5 rounded-full bg-destructive/10 text-destructive font-bold uppercase">Desconectado</span>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-medium">Nombre de carpeta en Drive</label>
                                <input type="text" id="config-drive-path" class="h-10 px-4 w-full" placeholder="p.ej. CloudNotesV3" autocomplete="off">
                                <p class="text-[10px] text-muted-foreground">Las notas se guardar√°n encriptadas dentro de esta carpeta.</p>
                            </div>
                            <button id="connect-drive-btn" class="btn-shad btn-shad-outline w-full h-10 flex items-center justify-center gap-2">
                                <i data-lucide="link" class="w-4 h-4"></i> Conectar con Google Drive
                            </button>
                            <button id="save-sync-config" class="btn-shad btn-shad-primary w-full h-10">Guardar Cambios</button>
                        </section>
                    </div>

                    <!-- Panel: Seguridad -->
                    <div id="panel-security" class="settings-panel hidden space-y-6">
                        <section class="space-y-4">
                            <h3 class="text-sm font-semibold uppercase tracking-wider text-muted-foreground">Encriptaci√≥n</h3>
                            <div class="space-y-2">
                                <label class="text-xs font-medium">Algoritmo preferido</label>
                                <select id="config-algo" class="h-10 w-full px-3">
                                    <option value="aes-256-gcm">AES-256-GCM (Recomendado)</option>
                                    <option value="kyber">CRYSTALS-Kyber (Experimental)</option>
                                </select>
                            </div>
                             <button id="save-security-config" class="btn-shad btn-shad-primary w-full h-10">Actualizar Algoritmo</button>
                        </section>
                    </div>

                    <!-- Panel: Danger Zone -->
                    <div id="panel-danger" class="settings-panel hidden space-y-6">
                        <section class="p-4 rounded-lg border border-destructive/20 bg-destructive/5 space-y-4">
                            <h3 class="text-sm font-semibold text-destructive uppercase tracking-wider">Acciones Irreversibles</h3>
                            <p class="text-xs text-muted-foreground">Al restaurar de f√°brica se borrar√°n todas las notas, categor√≠as y configuraciones de este navegador.</p>
                            <button id="factory-reset" class="btn-shad bg-destructive text-destructive-foreground hover:bg-destructive/90 w-full h-10">
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i> Borrar Todo Localmente
                            </button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>`}function Hn(){const t=document.querySelectorAll(".settings-panel"),e=document.querySelectorAll(".settings-tab"),n=document.getElementById("settings-tab-title");e.forEach(o=>{o.onclick=()=>{const i=o.dataset.tab;e.forEach(r=>r.classList.toggle("active",r===o)),t.forEach(r=>r.classList.toggle("hidden",r.id!==`panel-${i}`));const a={appearance:"Apariencia y Temas",sync:"Sincronizaci√≥n Cloud",security:"Seguridad y Cifrado",danger:"Zona Peligrosa"};n.innerText=a[i]||"Configuraci√≥n",K()}})}function jn(){return`
    <!-- Prompt Modal -->
    <div id="prompt-modal" class="fixed inset-0 z-[200] hidden">
        <div class="absolute inset-0 bg-background/90 backdrop-blur-xl"></div>
        <div class="dialog-content max-w-sm">
            <h2 id="prompt-title" class="text-lg font-bold mb-2">Seguridad</h2>
            <p id="prompt-desc" class="text-sm text-muted-foreground mb-6">Ingresa la contrase√±a para continuar</p>
            <div class="space-y-4">
                <div class="relative">
                    <input type="password" id="prompt-input" placeholder="Tu contrase√±a"
                        class="text-center tracking-widest outline-none pr-10">
                    <button type="button"
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground toggle-pass"
                        data-target="prompt-input">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                    </button>
                </div>
                <div class="flex gap-2">
                    <button id="prompt-cancel" class="btn-shad btn-shad-outline flex-1">Cancelar</button>
                    <button id="prompt-confirm" class="btn-shad btn-shad-primary flex-1">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">
        <div class="border">
            ¬°Acci√≥n completada!
        </div>
    </div>`}function St(t,e=null){const n=document.getElementById("sidebar-categories"),o=document.getElementById("mobile-sidebar-categories"),i=document.getElementById("edit-category"),a=document.getElementById("cat-dropdown-menu");e&&(u.categories=e),n&&(n.innerHTML=""),o&&(o.innerHTML=""),i&&(i.innerHTML='<option value="">Sin categor√≠a</option>'),a&&(a.innerHTML='<div class="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer border-b" data-id="">Sin categor√≠a</div>');const r=u.categories.length>0,s=document.getElementById("sidebar-categories-header"),l=document.getElementById("mobile-sidebar-categories-header");s&&s.classList.toggle("hidden",!r),l&&l.classList.toggle("hidden",!r),document.querySelectorAll('.nav-link[data-view="all"], .nav-link-mobile[data-view="all"], .nav-link-mobile-drawer[data-view="all"]').forEach(c=>{c.classList.toggle("active",u.currentView==="all")});const d=(c,g,v)=>{if(!a)return;const b=document.createElement("div");b.className="px-3 py-1.5 text-xs hover:bg-accent cursor-pointer flex items-center gap-2",b.innerHTML=`<div class="w-2 h-2 rounded-full" style="background-color: ${v}"></div> ${g}`,b.onclick=()=>{i&&(i.value=c),p(),a.classList.add("hidden")},a.appendChild(b)},p=()=>{const c=document.getElementById("edit-category").value,g=u.categories.find(v=>v.id===c);document.getElementById("selected-cat-label").innerText=g?g.name:"Sin categor√≠a"};if(a){const c=a.querySelector('[data-id=""]');c&&(c.onclick=()=>{i&&(i.value=""),p(),a.classList.add("hidden")})}u.categories.forEach(c=>{const g=(v=!1)=>{const b=document.createElement("button");b.className=v?"nav-link-mobile-drawer w-full group":"nav-link w-full group",u.currentView===c.id&&b.classList.add("active"),b.onclick=async()=>{if(c.passwordHash){const N=await be("Acceso Restringido",`Ingresa la contrase√±a para "${c.name}":`);if(!N)return;if(await F.hashPassword(N)!==c.passwordHash){T("Contrase√±a incorrecta");return}}document.querySelectorAll(".nav-link, .nav-link-mobile-drawer").forEach(N=>N.classList.remove("active")),b.classList.add("active"),t(c.id,c.name),v&&document.getElementById("mobile-sidebar-overlay").classList.add("hidden")};const E=u.settings.theme==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)";return b.innerHTML=`
                <div class="flex items-center gap-3">
                    <div class="w-2.5 h-2.5 rounded-full shadow-sm" style="background-color: ${c.color}; border: 1px solid ${E}"></div>
                    <span class="truncate">${c.name}</span>
                </div>
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    ${c.passwordHash?'<i data-lucide="lock" class="w-3 h-3 text-muted-foreground"></i>':""}
                </div>
            `,b};if(n&&n.appendChild(g(!1)),o&&o.appendChild(g(!0)),i){const v=document.createElement("option");v.value=c.id,v.innerText=c.name,i.appendChild(v)}d(c.id,c.name,c.color)}),K()}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,o)}return n}function J(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ht(Object(n),!0).forEach(function(o){$n(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function Ve(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ve=function(e){return typeof e}:Ve=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(t)}function $n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ee(){return ee=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},ee.apply(this,arguments)}function zn(t,e){if(t==null)return{};var n={},o=Object.keys(t),i,a;for(a=0;a<o.length;a++)i=o[a],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Fn(t,e){if(t==null)return{};var n=zn(t,e),o,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)o=a[i],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(t,o)&&(n[o]=t[o])}return n}var qn="1.15.6";function Q(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var te=Q(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),ze=Q(/Edge/i),jt=Q(/firefox/i),Ae=Q(/safari/i)&&!Q(/chrome/i)&&!Q(/android/i),Nt=Q(/iP(ad|od|hone)/i),Zt=Q(/chrome/i)&&Q(/android/i),Qt={capture:!1,passive:!1};function x(t,e,n){t.addEventListener(e,n,!te&&Qt)}function w(t,e,n){t.removeEventListener(e,n,!te&&Qt)}function Qe(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function en(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function Y(t,e,n,o){if(t){n=n||document;do{if(e!=null&&(e[0]===">"?t.parentNode===n&&Qe(t,e):Qe(t,e))||o&&t===n)return t;if(t===n)break}while(t=en(t))}return null}var $t=/\s+/g;function $(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var o=(" "+t.className+" ").replace($t," ").replace(" "+e+" "," ");t.className=(o+(n?" "+e:"")).replace($t," ")}}function m(t,e,n){var o=t&&t.style;if(o){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),e===void 0?n:n[e];!(e in o)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),o[e]=n+(typeof n=="string"?"":"px")}}function ve(t,e){var n="";if(typeof t=="string")n=t;else do{var o=m(t,"transform");o&&o!=="none"&&(n=o+" "+n)}while(!e&&(t=t.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(n)}function tn(t,e,n){if(t){var o=t.getElementsByTagName(e),i=0,a=o.length;if(n)for(;i<a;i++)n(o[i],i);return o}return[]}function U(){var t=document.scrollingElement;return t||document.documentElement}function D(t,e,n,o,i){if(!(!t.getBoundingClientRect&&t!==window)){var a,r,s,l,d,p,c;if(t!==window&&t.parentNode&&t!==U()?(a=t.getBoundingClientRect(),r=a.top,s=a.left,l=a.bottom,d=a.right,p=a.height,c=a.width):(r=0,s=0,l=window.innerHeight,d=window.innerWidth,p=window.innerHeight,c=window.innerWidth),(e||n)&&t!==window&&(i=i||t.parentNode,!te))do if(i&&i.getBoundingClientRect&&(m(i,"transform")!=="none"||n&&m(i,"position")!=="static")){var g=i.getBoundingClientRect();r-=g.top+parseInt(m(i,"border-top-width")),s-=g.left+parseInt(m(i,"border-left-width")),l=r+a.height,d=s+a.width;break}while(i=i.parentNode);if(o&&t!==window){var v=ve(i||t),b=v&&v.a,E=v&&v.d;v&&(r/=E,s/=b,c/=b,p/=E,l=r+p,d=s+c)}return{top:r,left:s,bottom:l,right:d,width:c,height:p}}}function zt(t,e,n){for(var o=re(t,!0),i=D(t)[e];o;){var a=D(o)[n],r=void 0;if(r=i>=a,!r)return o;if(o===U())break;o=re(o,!1)}return!1}function ye(t,e,n,o){for(var i=0,a=0,r=t.children;a<r.length;){if(r[a].style.display!=="none"&&r[a]!==h.ghost&&(o||r[a]!==h.dragged)&&Y(r[a],n.draggable,t,!1)){if(i===e)return r[a];i++}a++}return null}function Pt(t,e){for(var n=t.lastElementChild;n&&(n===h.ghost||m(n,"display")==="none"||e&&!Qe(n,e));)n=n.previousElementSibling;return n||null}function q(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==h.clone&&(!e||Qe(t,e))&&n++;return n}function Ft(t){var e=0,n=0,o=U();if(t)do{var i=ve(t),a=i.a,r=i.d;e+=t.scrollLeft*a,n+=t.scrollTop*r}while(t!==o&&(t=t.parentNode));return[e,n]}function Rn(t,e){for(var n in t)if(t.hasOwnProperty(n)){for(var o in e)if(e.hasOwnProperty(o)&&e[o]===t[n][o])return Number(n)}return-1}function re(t,e){if(!t||!t.getBoundingClientRect)return U();var n=t,o=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=m(n);if(n.clientWidth<n.scrollWidth&&(i.overflowX=="auto"||i.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(i.overflowY=="auto"||i.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return U();if(o||e)return n;o=!0}}while(n=n.parentNode);return U()}function Gn(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function lt(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var Le;function nn(t,e){return function(){if(!Le){var n=arguments,o=this;n.length===1?t.call(o,n[0]):t.apply(o,n),Le=setTimeout(function(){Le=void 0},e)}}}function Yn(){clearTimeout(Le),Le=void 0}function on(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function an(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function rn(t,e,n){var o={};return Array.from(t.children).forEach(function(i){var a,r,s,l;if(!(!Y(i,e.draggable,t,!1)||i.animated||i===n)){var d=D(i);o.left=Math.min((a=o.left)!==null&&a!==void 0?a:1/0,d.left),o.top=Math.min((r=o.top)!==null&&r!==void 0?r:1/0,d.top),o.right=Math.max((s=o.right)!==null&&s!==void 0?s:-1/0,d.right),o.bottom=Math.max((l=o.bottom)!==null&&l!==void 0?l:-1/0,d.bottom)}}),o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}var M="Sortable"+new Date().getTime();function Xn(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(i){if(!(m(i,"display")==="none"||i===h.ghost)){t.push({target:i,rect:D(i)});var a=J({},t[t.length-1].rect);if(i.thisAnimationDuration){var r=ve(i,!0);r&&(a.top-=r.f,a.left-=r.e)}i.fromRect=a}})}},addAnimationState:function(o){t.push(o)},removeAnimationState:function(o){t.splice(Rn(t,{target:o}),1)},animateAll:function(o){var i=this;if(!this.options.animation){clearTimeout(e),typeof o=="function"&&o();return}var a=!1,r=0;t.forEach(function(s){var l=0,d=s.target,p=d.fromRect,c=D(d),g=d.prevFromRect,v=d.prevToRect,b=s.rect,E=ve(d,!0);E&&(c.top-=E.f,c.left-=E.e),d.toRect=c,d.thisAnimationDuration&&lt(g,c)&&!lt(p,c)&&(b.top-c.top)/(b.left-c.left)===(p.top-c.top)/(p.left-c.left)&&(l=Vn(b,g,v,i.options)),lt(c,p)||(d.prevFromRect=p,d.prevToRect=c,l||(l=i.options.animation),i.animate(d,b,c,l)),l&&(a=!0,r=Math.max(r,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(e),a?e=setTimeout(function(){typeof o=="function"&&o()},r):typeof o=="function"&&o(),t=[]},animate:function(o,i,a,r){if(r){m(o,"transition",""),m(o,"transform","");var s=ve(this.el),l=s&&s.a,d=s&&s.d,p=(i.left-a.left)/(l||1),c=(i.top-a.top)/(d||1);o.animatingX=!!p,o.animatingY=!!c,m(o,"transform","translate3d("+p+"px,"+c+"px,0)"),this.forRepaintDummy=Wn(o),m(o,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),m(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){m(o,"transition",""),m(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},r)}}}}function Wn(t){return t.offsetWidth}function Vn(t,e,n,o){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*o.animation}var pe=[],dt={initializeByDefault:!0},Fe={mount:function(e){for(var n in dt)dt.hasOwnProperty(n)&&!(n in e)&&(e[n]=dt[n]);pe.forEach(function(o){if(o.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),pe.push(e)},pluginEvent:function(e,n,o){var i=this;this.eventCanceled=!1,o.cancel=function(){i.eventCanceled=!0};var a=e+"Global";pe.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][a]&&n[r.pluginName][a](J({sortable:n},o)),n.options[r.pluginName]&&n[r.pluginName][e]&&n[r.pluginName][e](J({sortable:n},o)))})},initializePlugins:function(e,n,o,i){pe.forEach(function(s){var l=s.pluginName;if(!(!e.options[l]&&!s.initializeByDefault)){var d=new s(e,n,e.options);d.sortable=e,d.options=e.options,e[l]=d,ee(o,d.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var r=this.modifyOption(e,a,e.options[a]);typeof r<"u"&&(e.options[a]=r)}},getEventProperties:function(e,n){var o={};return pe.forEach(function(i){typeof i.eventProperties=="function"&&ee(o,i.eventProperties.call(n[i.pluginName],e))}),o},modifyOption:function(e,n,o){var i;return pe.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[n]=="function"&&(i=a.optionListeners[n].call(e[a.pluginName],o))}),i}};function Un(t){var e=t.sortable,n=t.rootEl,o=t.name,i=t.targetEl,a=t.cloneEl,r=t.toEl,s=t.fromEl,l=t.oldIndex,d=t.newIndex,p=t.oldDraggableIndex,c=t.newDraggableIndex,g=t.originalEvent,v=t.putSortable,b=t.extraEventProperties;if(e=e||n&&n[M],!!e){var E,N=e.options,W="on"+o.charAt(0).toUpperCase()+o.substr(1);window.CustomEvent&&!te&&!ze?E=new CustomEvent(o,{bubbles:!0,cancelable:!0}):(E=document.createEvent("Event"),E.initEvent(o,!0,!0)),E.to=r||n,E.from=s||n,E.item=i||n,E.clone=a,E.oldIndex=l,E.newIndex=d,E.oldDraggableIndex=p,E.newDraggableIndex=c,E.originalEvent=g,E.pullMode=v?v.lastPutMode:void 0;var A=J(J({},b),Fe.getEventProperties(o,e));for(var R in A)E[R]=A[R];n&&n.dispatchEvent(E),N[W]&&N[W].call(e,E)}}var Jn=["evt"],O=function(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=o.evt,a=Fn(o,Jn);Fe.pluginEvent.bind(h)(e,n,J({dragEl:f,parentEl:k,ghostEl:y,rootEl:I,nextEl:fe,lastDownEl:Ue,cloneEl:_,cloneHidden:ae,dragStarted:Ce,putSortable:B,activeSortable:h.active,originalEvent:i,oldIndex:he,oldDraggableIndex:Oe,newIndex:z,newDraggableIndex:ie,hideGhostForTarget:cn,unhideGhostForTarget:un,cloneNowHidden:function(){ae=!0},cloneNowShown:function(){ae=!1},dispatchSortableEvent:function(s){L({sortable:n,name:s,originalEvent:i})}},a))};function L(t){Un(J({putSortable:B,cloneEl:_,targetEl:f,rootEl:I,oldIndex:he,oldDraggableIndex:Oe,newIndex:z,newDraggableIndex:ie},t))}var f,k,y,I,fe,Ue,_,ae,he,z,Oe,ie,Ge,B,me=!1,et=!1,tt=[],ce,G,ct,ut,qt,Rt,Ce,ge,Me,He=!1,Ye=!1,Je,P,ft=[],It=!1,nt=[],rt=typeof document<"u",Xe=Nt,Gt=ze||te?"cssFloat":"float",Kn=rt&&!Zt&&!Nt&&"draggable"in document.createElement("div"),sn=function(){if(rt){if(te)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),ln=function(e,n){var o=m(e),i=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),a=ye(e,0,n),r=ye(e,1,n),s=a&&m(a),l=r&&m(r),d=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+D(a).width,p=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+D(r).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&s.float&&s.float!=="none"){var c=s.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===c)?"vertical":"horizontal"}return a&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||d>=i&&o[Gt]==="none"||r&&o[Gt]==="none"&&d+p>i)?"vertical":"horizontal"},Zn=function(e,n,o){var i=o?e.left:e.top,a=o?e.right:e.bottom,r=o?e.width:e.height,s=o?n.left:n.top,l=o?n.right:n.bottom,d=o?n.width:n.height;return i===s||a===l||i+r/2===s+d/2},Qn=function(e,n){var o;return tt.some(function(i){var a=i[M].options.emptyInsertThreshold;if(!(!a||Pt(i))){var r=D(i),s=e>=r.left-a&&e<=r.right+a,l=n>=r.top-a&&n<=r.bottom+a;if(s&&l)return o=i}}),o},dn=function(e){function n(a,r){return function(s,l,d,p){var c=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(a==null&&(r||c))return!0;if(a==null||a===!1)return!1;if(r&&a==="clone")return a;if(typeof a=="function")return n(a(s,l,d,p),r)(s,l,d,p);var g=(r?s:l).options.group.name;return a===!0||typeof a=="string"&&a===g||a.join&&a.indexOf(g)>-1}}var o={},i=e.group;(!i||Ve(i)!="object")&&(i={name:i}),o.name=i.name,o.checkPull=n(i.pull,!0),o.checkPut=n(i.put),o.revertClone=i.revertClone,e.group=o},cn=function(){!sn&&y&&m(y,"display","none")},un=function(){!sn&&y&&m(y,"display","")};rt&&!Zt&&document.addEventListener("click",function(t){if(et)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),et=!1,!1},!0);var ue=function(e){if(f){e=e.touches?e.touches[0]:e;var n=Qn(e.clientX,e.clientY);if(n){var o={};for(var i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);o.target=o.rootEl=n,o.preventDefault=void 0,o.stopPropagation=void 0,n[M]._onDragOver(o)}}},eo=function(e){f&&f.parentNode[M]._isOutsideThisEl(e.target)};function h(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=ee({},e),t[M]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ln(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,s){r.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:h.supportPointer!==!1&&"PointerEvent"in window&&(!Ae||Nt),emptyInsertThreshold:5};Fe.initializePlugins(this,t,n);for(var o in n)!(o in e)&&(e[o]=n[o]);dn(e);for(var i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=e.forceFallback?!1:Kn,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(t,"pointerdown",this._onTapStart):(x(t,"mousedown",this._onTapStart),x(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(t,"dragover",this),x(t,"dragenter",this)),tt.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ee(this,Xn())}h.prototype={constructor:h,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(ge=null)},_getDirection:function(e,n){return typeof this.options.direction=="function"?this.options.direction.call(this,e,n,f):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,o=this.el,i=this.options,a=i.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(s||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,p=i.filter;if(lo(o),!f&&!(/mousedown|pointerdown/.test(r)&&e.button!==0||i.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Ae&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Y(l,i.draggable,o,!1),!(l&&l.animated)&&Ue!==l)){if(he=q(l),Oe=q(l,i.draggable),typeof p=="function"){if(p.call(this,e,l,this)){L({sortable:n,rootEl:d,name:"filter",targetEl:l,toEl:o,fromEl:o}),O("filter",n,{evt:e}),a&&e.preventDefault();return}}else if(p&&(p=p.split(",").some(function(c){if(c=Y(d,c.trim(),o,!1),c)return L({sortable:n,rootEl:c,name:"filter",targetEl:l,fromEl:o,toEl:o}),O("filter",n,{evt:e}),!0}),p)){a&&e.preventDefault();return}i.handle&&!Y(d,i.handle,o,!1)||this._prepareDragStart(e,s,l)}}},_prepareDragStart:function(e,n,o){var i=this,a=i.el,r=i.options,s=a.ownerDocument,l;if(o&&!f&&o.parentNode===a){var d=D(o);if(I=a,f=o,k=f.parentNode,fe=f.nextSibling,Ue=o,Ge=r.group,h.dragged=f,ce={target:f,clientX:(n||e).clientX,clientY:(n||e).clientY},qt=ce.clientX-d.left,Rt=ce.clientY-d.top,this._lastX=(n||e).clientX,this._lastY=(n||e).clientY,f.style["will-change"]="all",l=function(){if(O("delayEnded",i,{evt:e}),h.eventCanceled){i._onDrop();return}i._disableDelayedDragEvents(),!jt&&i.nativeDraggable&&(f.draggable=!0),i._triggerDragStart(e,n),L({sortable:i,name:"choose",originalEvent:e}),$(f,r.chosenClass,!0)},r.ignore.split(",").forEach(function(p){tn(f,p.trim(),pt)}),x(s,"dragover",ue),x(s,"mousemove",ue),x(s,"touchmove",ue),r.supportPointer?(x(s,"pointerup",i._onDrop),!this.nativeDraggable&&x(s,"pointercancel",i._onDrop)):(x(s,"mouseup",i._onDrop),x(s,"touchend",i._onDrop),x(s,"touchcancel",i._onDrop)),jt&&this.nativeDraggable&&(this.options.touchStartThreshold=4,f.draggable=!0),O("delayStart",this,{evt:e}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(ze||te))){if(h.eventCanceled){this._onDrop();return}r.supportPointer?(x(s,"pointerup",i._disableDelayedDrag),x(s,"pointercancel",i._disableDelayedDrag)):(x(s,"mouseup",i._disableDelayedDrag),x(s,"touchend",i._disableDelayedDrag),x(s,"touchcancel",i._disableDelayedDrag)),x(s,"mousemove",i._delayedDragTouchMoveHandler),x(s,"touchmove",i._delayedDragTouchMoveHandler),r.supportPointer&&x(s,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var n=e.touches?e.touches[0]:e;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){f&&pt(f),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;w(e,"mouseup",this._disableDelayedDrag),w(e,"touchend",this._disableDelayedDrag),w(e,"touchcancel",this._disableDelayedDrag),w(e,"pointerup",this._disableDelayedDrag),w(e,"pointercancel",this._disableDelayedDrag),w(e,"mousemove",this._delayedDragTouchMoveHandler),w(e,"touchmove",this._delayedDragTouchMoveHandler),w(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,n){n=n||e.pointerType=="touch"&&e,!this.nativeDraggable||n?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):n?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(f,"dragend",this),x(I,"dragstart",this._onDragStart));try{document.selection?Ke(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,n){if(me=!1,I&&f){O("dragStarted",this,{evt:n}),this.nativeDraggable&&x(document,"dragover",eo);var o=this.options;!e&&$(f,o.dragClass,!1),$(f,o.ghostClass,!0),h.active=this,e&&this._appendGhost(),L({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(G){this._lastX=G.clientX,this._lastY=G.clientY,cn();for(var e=document.elementFromPoint(G.clientX,G.clientY),n=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(G.clientX,G.clientY),e!==n);)n=e;if(f.parentNode[M]._isOutsideThisEl(e),n)do{if(n[M]){var o=void 0;if(o=n[M]._onDragOver({clientX:G.clientX,clientY:G.clientY,target:e,rootEl:n}),o&&!this.options.dragoverBubble)break}e=n}while(n=en(n));un()}},_onTouchMove:function(e){if(ce){var n=this.options,o=n.fallbackTolerance,i=n.fallbackOffset,a=e.touches?e.touches[0]:e,r=y&&ve(y,!0),s=y&&r&&r.a,l=y&&r&&r.d,d=Xe&&P&&Ft(P),p=(a.clientX-ce.clientX+i.x)/(s||1)+(d?d[0]-ft[0]:0)/(s||1),c=(a.clientY-ce.clientY+i.y)/(l||1)+(d?d[1]-ft[1]:0)/(l||1);if(!h.active&&!me){if(o&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(y){r?(r.e+=p-(ct||0),r.f+=c-(ut||0)):r={a:1,b:0,c:0,d:1,e:p,f:c};var g="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");m(y,"webkitTransform",g),m(y,"mozTransform",g),m(y,"msTransform",g),m(y,"transform",g),ct=p,ut=c,G=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!y){var e=this.options.fallbackOnBody?document.body:I,n=D(f,!0,Xe,!0,e),o=this.options;if(Xe){for(P=e;m(P,"position")==="static"&&m(P,"transform")==="none"&&P!==document;)P=P.parentNode;P!==document.body&&P!==document.documentElement?(P===document&&(P=U()),n.top+=P.scrollTop,n.left+=P.scrollLeft):P=U(),ft=Ft(P)}y=f.cloneNode(!0),$(y,o.ghostClass,!1),$(y,o.fallbackClass,!0),$(y,o.dragClass,!0),m(y,"transition",""),m(y,"transform",""),m(y,"box-sizing","border-box"),m(y,"margin",0),m(y,"top",n.top),m(y,"left",n.left),m(y,"width",n.width),m(y,"height",n.height),m(y,"opacity","0.8"),m(y,"position",Xe?"absolute":"fixed"),m(y,"zIndex","100000"),m(y,"pointerEvents","none"),h.ghost=y,e.appendChild(y),m(y,"transform-origin",qt/parseInt(y.style.width)*100+"% "+Rt/parseInt(y.style.height)*100+"%")}},_onDragStart:function(e,n){var o=this,i=e.dataTransfer,a=o.options;if(O("dragStart",this,{evt:e}),h.eventCanceled){this._onDrop();return}O("setupClone",this),h.eventCanceled||(_=an(f),_.removeAttribute("id"),_.draggable=!1,_.style["will-change"]="",this._hideClone(),$(_,this.options.chosenClass,!1),h.clone=_),o.cloneId=Ke(function(){O("clone",o),!h.eventCanceled&&(o.options.removeCloneOnHide||I.insertBefore(_,f),o._hideClone(),L({sortable:o,name:"clone"}))}),!n&&$(f,a.dragClass,!0),n?(et=!0,o._loopId=setInterval(o._emulateDragOver,50)):(w(document,"mouseup",o._onDrop),w(document,"touchend",o._onDrop),w(document,"touchcancel",o._onDrop),i&&(i.effectAllowed="move",a.setData&&a.setData.call(o,i,f)),x(document,"drop",o),m(f,"transform","translateZ(0)")),me=!0,o._dragStartId=Ke(o._dragStarted.bind(o,n,e)),x(document,"selectstart",o),Ce=!0,window.getSelection().removeAllRanges(),Ae&&m(document.body,"user-select","none")},_onDragOver:function(e){var n=this.el,o=e.target,i,a,r,s=this.options,l=s.group,d=h.active,p=Ge===l,c=s.sort,g=B||d,v,b=this,E=!1;if(It)return;function N(_e,mn){O(_e,b,J({evt:e,isOwner:p,axis:v?"vertical":"horizontal",revert:r,dragRect:i,targetRect:a,canSort:c,fromSortable:g,target:o,completed:A,onMove:function(Ot,hn){return We(I,n,f,i,Ot,D(Ot),e,hn)},changed:R},mn))}function W(){N("dragOverAnimationCapture"),b.captureAnimationState(),b!==g&&g.captureAnimationState()}function A(_e){return N("dragOverCompleted",{insertion:_e}),_e&&(p?d._hideClone():d._showClone(b),b!==g&&($(f,B?B.options.ghostClass:d.options.ghostClass,!1),$(f,s.ghostClass,!0)),B!==b&&b!==h.active?B=b:b===h.active&&B&&(B=null),g===b&&(b._ignoreWhileAnimating=o),b.animateAll(function(){N("dragOverAnimationComplete"),b._ignoreWhileAnimating=null}),b!==g&&(g.animateAll(),g._ignoreWhileAnimating=null)),(o===f&&!f.animated||o===n&&!o.animated)&&(ge=null),!s.dragoverBubble&&!e.rootEl&&o!==document&&(f.parentNode[M]._isOutsideThisEl(e.target),!_e&&ue(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),E=!0}function R(){z=q(f),ie=q(f,s.draggable),L({sortable:b,name:"change",toEl:n,newIndex:z,newDraggableIndex:ie,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),o=Y(o,s.draggable,n,!0),N("dragOver"),h.eventCanceled)return E;if(f.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||b._ignoreWhileAnimating===o)return A(!1);if(et=!1,d&&!s.disabled&&(p?c||(r=k!==I):B===this||(this.lastPutMode=Ge.checkPull(this,d,f,e))&&l.checkPut(this,d,f,e))){if(v=this._getDirection(e,o)==="vertical",i=D(f),N("dragOverValid"),h.eventCanceled)return E;if(r)return k=I,W(),this._hideClone(),N("revert"),h.eventCanceled||(fe?I.insertBefore(f,fe):I.appendChild(f)),A(!0);var H=Pt(n,s.draggable);if(!H||io(e,v,this)&&!H.animated){if(H===f)return A(!1);if(H&&n===e.target&&(o=H),o&&(a=D(o)),We(I,n,f,i,o,a,e,!!o)!==!1)return W(),H&&H.nextSibling?n.insertBefore(f,H.nextSibling):n.appendChild(f),k=n,R(),A(!0)}else if(H&&oo(e,v,this)){var se=ye(n,0,s,!0);if(se===f)return A(!1);if(o=se,a=D(o),We(I,n,f,i,o,a,e,!1)!==!1)return W(),n.insertBefore(f,se),k=n,R(),A(!0)}else if(o.parentNode===n){a=D(o);var V=0,le,xe=f.parentNode!==n,j=!Zn(f.animated&&f.toRect||i,o.animated&&o.toRect||a,v),Ee=v?"top":"left",ne=zt(o,"top","top")||zt(f,"top","top"),Se=ne?ne.scrollTop:void 0;ge!==o&&(le=a[Ee],He=!1,Ye=!j&&s.invertSwap||xe),V=ao(e,o,a,v,j?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,Ye,ge===o);var Z;if(V!==0){var de=q(f);do de-=V,Z=k.children[de];while(Z&&(m(Z,"display")==="none"||Z===y))}if(V===0||Z===o)return A(!1);ge=o,Me=V;var Ie=o.nextElementSibling,oe=!1;oe=V===1;var qe=We(I,n,f,i,o,a,e,oe);if(qe!==!1)return(qe===1||qe===-1)&&(oe=qe===1),It=!0,setTimeout(no,30),W(),oe&&!Ie?n.appendChild(f):o.parentNode.insertBefore(f,oe?Ie:o),ne&&on(ne,0,Se-ne.scrollTop),k=f.parentNode,le!==void 0&&!Ye&&(Je=Math.abs(le-D(o)[Ee])),R(),A(!0)}if(n.contains(f))return A(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){w(document,"mousemove",this._onTouchMove),w(document,"touchmove",this._onTouchMove),w(document,"pointermove",this._onTouchMove),w(document,"dragover",ue),w(document,"mousemove",ue),w(document,"touchmove",ue)},_offUpEvents:function(){var e=this.el.ownerDocument;w(e,"mouseup",this._onDrop),w(e,"touchend",this._onDrop),w(e,"pointerup",this._onDrop),w(e,"pointercancel",this._onDrop),w(e,"touchcancel",this._onDrop),w(document,"selectstart",this)},_onDrop:function(e){var n=this.el,o=this.options;if(z=q(f),ie=q(f,o.draggable),O("drop",this,{evt:e}),k=f&&f.parentNode,z=q(f),ie=q(f,o.draggable),h.eventCanceled){this._nulling();return}me=!1,Ye=!1,He=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_t(this.cloneId),_t(this._dragStartId),this.nativeDraggable&&(w(document,"drop",this),w(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ae&&m(document.body,"user-select",""),m(f,"transform",""),e&&(Ce&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),y&&y.parentNode&&y.parentNode.removeChild(y),(I===k||B&&B.lastPutMode!=="clone")&&_&&_.parentNode&&_.parentNode.removeChild(_),f&&(this.nativeDraggable&&w(f,"dragend",this),pt(f),f.style["will-change"]="",Ce&&!me&&$(f,B?B.options.ghostClass:this.options.ghostClass,!1),$(f,this.options.chosenClass,!1),L({sortable:this,name:"unchoose",toEl:k,newIndex:null,newDraggableIndex:null,originalEvent:e}),I!==k?(z>=0&&(L({rootEl:k,name:"add",toEl:k,fromEl:I,originalEvent:e}),L({sortable:this,name:"remove",toEl:k,originalEvent:e}),L({rootEl:k,name:"sort",toEl:k,fromEl:I,originalEvent:e}),L({sortable:this,name:"sort",toEl:k,originalEvent:e})),B&&B.save()):z!==he&&z>=0&&(L({sortable:this,name:"update",toEl:k,originalEvent:e}),L({sortable:this,name:"sort",toEl:k,originalEvent:e})),h.active&&((z==null||z===-1)&&(z=he,ie=Oe),L({sortable:this,name:"end",toEl:k,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){O("nulling",this),I=f=k=y=fe=_=Ue=ae=ce=G=Ce=z=ie=he=Oe=ge=Me=B=Ge=h.dragged=h.ghost=h.clone=h.active=null,nt.forEach(function(e){e.checked=!0}),nt.length=ct=ut=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":f&&(this._onDragOver(e),to(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],n,o=this.el.children,i=0,a=o.length,r=this.options;i<a;i++)n=o[i],Y(n,r.draggable,this.el,!1)&&e.push(n.getAttribute(r.dataIdAttr)||so(n));return e},sort:function(e,n){var o={},i=this.el;this.toArray().forEach(function(a,r){var s=i.children[r];Y(s,this.options.draggable,i,!1)&&(o[a]=s)},this),n&&this.captureAnimationState(),e.forEach(function(a){o[a]&&(i.removeChild(o[a]),i.appendChild(o[a]))}),n&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,n){return Y(e,n||this.options.draggable,this.el,!1)},option:function(e,n){var o=this.options;if(n===void 0)return o[e];var i=Fe.modifyOption(this,e,n);typeof i<"u"?o[e]=i:o[e]=n,e==="group"&&dn(o)},destroy:function(){O("destroy",this);var e=this.el;e[M]=null,w(e,"mousedown",this._onTapStart),w(e,"touchstart",this._onTapStart),w(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(w(e,"dragover",this),w(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),tt.splice(tt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!ae){if(O("hideClone",this),h.eventCanceled)return;m(_,"display","none"),this.options.removeCloneOnHide&&_.parentNode&&_.parentNode.removeChild(_),ae=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(ae){if(O("showClone",this),h.eventCanceled)return;f.parentNode==I&&!this.options.group.revertClone?I.insertBefore(_,f):fe?I.insertBefore(_,fe):I.appendChild(_),this.options.group.revertClone&&this.animate(f,_),m(_,"display",""),ae=!1}}};function to(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function We(t,e,n,o,i,a,r,s){var l,d=t[M],p=d.options.onMove,c;return window.CustomEvent&&!te&&!ze?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=n,l.draggedRect=o,l.related=i||e,l.relatedRect=a||D(e),l.willInsertAfter=s,l.originalEvent=r,t.dispatchEvent(l),p&&(c=p.call(d,l,r)),c}function pt(t){t.draggable=!1}function no(){It=!1}function oo(t,e,n){var o=D(ye(n.el,0,n.options,!0)),i=rn(n.el,n.options,y),a=10;return e?t.clientX<i.left-a||t.clientY<o.top&&t.clientX<o.right:t.clientY<i.top-a||t.clientY<o.bottom&&t.clientX<o.left}function io(t,e,n){var o=D(Pt(n.el,n.options.draggable)),i=rn(n.el,n.options,y),a=10;return e?t.clientX>i.right+a||t.clientY>o.bottom&&t.clientX>o.left:t.clientY>i.bottom+a||t.clientX>o.right&&t.clientY>o.top}function ao(t,e,n,o,i,a,r,s){var l=o?t.clientY:t.clientX,d=o?n.height:n.width,p=o?n.top:n.left,c=o?n.bottom:n.right,g=!1;if(!r){if(s&&Je<d*i){if(!He&&(Me===1?l>p+d*a/2:l<c-d*a/2)&&(He=!0),He)g=!0;else if(Me===1?l<p+Je:l>c-Je)return-Me}else if(l>p+d*(1-i)/2&&l<c-d*(1-i)/2)return ro(e)}return g=g||r,g&&(l<p+d*a/2||l>c-d*a/2)?l>p+d/2?1:-1:0}function ro(t){return q(f)<q(t)?1:-1}function so(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,o=0;n--;)o+=e.charCodeAt(n);return o.toString(36)}function lo(t){nt.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var o=e[n];o.checked&&nt.push(o)}}function Ke(t){return setTimeout(t,0)}function _t(t){return clearTimeout(t)}rt&&x(document,"touchmove",function(t){(h.active||me)&&t.cancelable&&t.preventDefault()});h.utils={on:x,off:w,css:m,find:tn,is:function(e,n){return!!Y(e,n,e,!1)},extend:Gn,throttle:nn,closest:Y,toggleClass:$,clone:an,index:q,nextTick:Ke,cancelNextTick:_t,detectDirection:ln,getChild:ye,expando:M};h.get=function(t){return t[M]};h.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(o){if(!o.prototype||!o.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(o));o.utils&&(h.utils=J(J({},h.utils),o.utils)),Fe.mount(o)})};h.create=function(t,e){return new h(t,e)};h.version=qn;var C=[],De,kt,Tt=!1,gt,mt,ot,Be;function co(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(n){var o=n.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):o.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var o=n.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?w(document,"dragover",this._handleAutoScroll):(w(document,"pointermove",this._handleFallbackAutoScroll),w(document,"touchmove",this._handleFallbackAutoScroll),w(document,"mousemove",this._handleFallbackAutoScroll)),Yt(),Ze(),Yn()},nulling:function(){ot=kt=De=Tt=Be=gt=mt=null,C.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,o){var i=this,a=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,s=document.elementFromPoint(a,r);if(ot=n,o||this.options.forceAutoScrollFallback||ze||te||Ae){ht(n,this.options,s,o);var l=re(s,!0);Tt&&(!Be||a!==gt||r!==mt)&&(Be&&Yt(),Be=setInterval(function(){var d=re(document.elementFromPoint(a,r),!0);d!==l&&(l=d,Ze()),ht(n,i.options,d,o)},10),gt=a,mt=r)}else{if(!this.options.bubbleScroll||re(s,!0)===U()){Ze();return}ht(n,this.options,re(s,!1),!1)}}},ee(t,{pluginName:"scroll",initializeByDefault:!0})}function Ze(){C.forEach(function(t){clearInterval(t.pid)}),C=[]}function Yt(){clearInterval(Be)}var ht=nn(function(t,e,n,o){if(e.scroll){var i=(t.touches?t.touches[0]:t).clientX,a=(t.touches?t.touches[0]:t).clientY,r=e.scrollSensitivity,s=e.scrollSpeed,l=U(),d=!1,p;kt!==n&&(kt=n,Ze(),De=e.scroll,p=e.scrollFn,De===!0&&(De=re(n,!0)));var c=0,g=De;do{var v=g,b=D(v),E=b.top,N=b.bottom,W=b.left,A=b.right,R=b.width,H=b.height,se=void 0,V=void 0,le=v.scrollWidth,xe=v.scrollHeight,j=m(v),Ee=v.scrollLeft,ne=v.scrollTop;v===l?(se=R<le&&(j.overflowX==="auto"||j.overflowX==="scroll"||j.overflowX==="visible"),V=H<xe&&(j.overflowY==="auto"||j.overflowY==="scroll"||j.overflowY==="visible")):(se=R<le&&(j.overflowX==="auto"||j.overflowX==="scroll"),V=H<xe&&(j.overflowY==="auto"||j.overflowY==="scroll"));var Se=se&&(Math.abs(A-i)<=r&&Ee+R<le)-(Math.abs(W-i)<=r&&!!Ee),Z=V&&(Math.abs(N-a)<=r&&ne+H<xe)-(Math.abs(E-a)<=r&&!!ne);if(!C[c])for(var de=0;de<=c;de++)C[de]||(C[de]={});(C[c].vx!=Se||C[c].vy!=Z||C[c].el!==v)&&(C[c].el=v,C[c].vx=Se,C[c].vy=Z,clearInterval(C[c].pid),(Se!=0||Z!=0)&&(d=!0,C[c].pid=setInterval((function(){o&&this.layer===0&&h.active._onTouchMove(ot);var Ie=C[this.layer].vy?C[this.layer].vy*s:0,oe=C[this.layer].vx?C[this.layer].vx*s:0;typeof p=="function"&&p.call(h.dragged.parentNode[M],oe,Ie,t,ot,C[this.layer].el)!=="continue"||on(C[this.layer].el,oe,Ie)}).bind({layer:c}),24))),c++}while(e.bubbleScroll&&g!==l&&(g=re(g,!1)));Tt=d}},30),fn=function(e){var n=e.originalEvent,o=e.putSortable,i=e.dragEl,a=e.activeSortable,r=e.dispatchSortableEvent,s=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(n){var d=o||a;s();var p=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,c=document.elementFromPoint(p.clientX,p.clientY);l(),d&&!d.el.contains(c)&&(r("spill"),this.onSpill({dragEl:i,putSortable:o}))}};function At(){}At.prototype={startIndex:null,dragStart:function(e){var n=e.oldDraggableIndex;this.startIndex=n},onSpill:function(e){var n=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var i=ye(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(n,i):this.sortable.el.appendChild(n),this.sortable.animateAll(),o&&o.animateAll()},drop:fn};ee(At,{pluginName:"revertOnSpill"});function Lt(){}Lt.prototype={onSpill:function(e){var n=e.dragEl,o=e.putSortable,i=o||this.sortable;i.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),i.animateAll()},drop:fn};ee(Lt,{pluginName:"removeOnSpill"});h.mount(new co);h.mount(Lt,At);function it(t){const e=document.getElementById("notes-grid");if(!e)return;e.innerHTML="";const n=u.currentView==="all"?u.notes.filter(r=>{const s=u.categories.find(l=>l.id===r.categoryId);return!s||!s.passwordHash}):u.notes.filter(r=>r.categoryId===u.currentView),o=n.filter(r=>r.pinned),i=n.filter(r=>!r.pinned),a=r=>{const s=document.createElement("div");s.className="note-card note-animate-in relative group",s.dataset.id=r.id;const l=je.find(g=>g.id===r.themeId)||je[0],d=u.settings.theme==="dark"?l.dark:l.light;r.themeId!=="default"&&(s.style.backgroundColor=d,s.style.borderColor=u.settings.theme==="dark"?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)");const p=u.categories.find(g=>g.id===r.categoryId),c=u.unlockedNotes.has(r.id);return s.innerHTML=`
            <div class="note-card-content">
                <div class="flex items-start justify-between mb-3">
                    <h3 class="font-bold text-sm line-clamp-2 leading-tight">${r.title}</h3>
                    <div class="flex gap-1.5 opacity-60">
                        ${r.pinned?'<i data-lucide="pin" class="w-3.5 h-3.5 fill-current"></i>':""}
                        ${r.passwordHash?`<i data-lucide="${c?"unlock":"lock"}" class="w-3.5 h-3.5 lock-indicator cursor-pointer" data-id="${r.id}"></i>`:""}
                    </div>
                </div>
                <div class="text-[13px] opacity-70 line-clamp-5 mb-6 leading-relaxed flex-1">
                    ${r.passwordHash&&!c?'<div class="flex items-center gap-2 py-4 italic opacity-50"><i data-lucide="shield-alert" class="w-4 h-4"></i> Contenido protegido</div>':r.content}
                </div>
                <div class="flex items-center justify-between mt-auto pt-3 border-t">
                    <div class="flex items-center gap-2">
                         ${p?`<span class="text-[10px] px-2 py-0.5 rounded bg-muted font-medium text-muted-foreground">${p.name}</span>`:""}
                         <span class="text-[10px] text-muted-foreground font-mono">${new Date(r.updatedAt).toLocaleDateString()}</span>
                    </div>
                    <button class="delete-note-btn p-1.5 rounded-md hover:bg-accent hover:text-accent-foreground transition-colors opacity-0 group-hover:opacity-100" data-id="${r.id}" title="Eliminar">
                        <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                    </button>
                </div>
            </div>
        `,s.onclick=async g=>{if(!g.target.closest(".delete-note-btn")){if(r.passwordHash&&!u.unlockedNotes.has(r.id)){const v=await openPrompt("Nota Protegida","Ingresa la contrase√±a para ver esta nota:");if(!v)return;if(await Security.hashPassword(v)!==r.passwordHash){showToast("‚ùå Contrase√±a incorrecta");return}u.unlockedNotes.add(r.id),it(t),t(r);return}t(r)}},s};if(o.length>0){const r=document.createElement("h3");if(r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2 flex items-center gap-2",r.innerHTML='<i data-lucide="pin" class="w-3 h-3"></i> Destacadas',e.appendChild(r),o.forEach(s=>e.appendChild(a(s))),i.length>0){const s=document.createElement("div");s.className="col-span-full h-px bg-border my-4",e.appendChild(s)}}if(i.length>0){if(o.length>0){const r=document.createElement("h3");r.className="text-xs font-bold text-muted-foreground uppercase tracking-wider col-span-full mb-2 mt-2",r.innerText="Notas",e.appendChild(r)}i.forEach(r=>e.appendChild(a(r)))}n.length===0&&(e.innerHTML=`<div class="col-span-full text-center py-20 text-muted-foreground opacity-50">
            <i data-lucide="ghost" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
            <p>No hay notas aqu√≠</p>
        </div>`),K(),e.querySelectorAll(".delete-note-btn").forEach(r=>{r.onclick=async s=>{s.stopPropagation();const l=r.dataset.id,d=u.notes.find(p=>p.id===l);if(d!=null&&d.passwordHash&&!u.unlockedNotes.has(d.id)){const p=await openPrompt("Eliminar Nota Protegida","Ingresa la contrase√±a para autorizar la eliminaci√≥n:");if(!p)return;if(await Security.hashPassword(p)!==d.passwordHash)return showToast("‚ùå Contrase√±a incorrecta")}confirm("¬øEliminar esta nota?")&&(u.notes=u.notes.filter(p=>p.id!==l),await X(),it(t),window.triggerAutoSync&&window.triggerAutoSync())}}),uo()}function uo(t){const e=document.getElementById("notes-grid");e&&(e.sortable&&e.sortable.destroy(),e.sortable=h.create(e,{animation:250,ghostClass:"opacity-50",onEnd:async()=>{const n=[];e.querySelectorAll(".note-card").forEach(a=>{const r=u.notes.find(s=>s.id===a.dataset.id);r&&n.push(r)});const o=new Set(n.map(a=>a.id)),i=u.notes.filter(a=>!o.has(a.id));u.notes=[...n,...i],await X()}}))}const fo="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com";let ke=null;async function Xt(){console.log("Iniciando aplicaci√≥n modular..."),localStorage.removeItem("cn_pass_plain_v3"),po(),vn(),gn(),Cn(we),Hn(),go(),await Sn(we),mo(),ho(),bo(),yo(),vo(),Eo(),K(),console.log("Aplicaci√≥n lista.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Xt):Xt();function po(){const t=document.getElementById("root");if(!t)return console.error("No se encontr√≥ el elemento #root");t.innerHTML=`
        ${En()}
        ${kn()}
        ${Tn()}
        ${Pn()}
        ${Mn()}
        ${jn()}
    `,console.log("Estructura inyectada.")}function we(){it(Ne),St(at,u.categories),pn(),K()}function at(t,e){u.currentView=t,pn(e),it(Ne)}function pn(t=null){const e=document.getElementById("view-title"),n=document.getElementById("view-desc");if(!e||!n)return;const o=u.categories.find(a=>a.id===u.currentView),i=t||(o?o.name:"Todas las notas");e.innerText=i,n.innerText=u.currentView==="all"?"Organiza tus pensamientos y protege tu privacidad.":`Mostrando notas en "${i}".`}function gn(){const t=u.settings.theme==="dark";document.documentElement.classList.toggle("dark",t),document.documentElement.classList.toggle("light",!t)}function S(t,e){const n=document.getElementById(t);n&&(n.onclick=e)}function go(){S("add-note-btn",Ne),S("mobile-add-btn",Ne),S("sync-btn",Ct),S("mobile-sync-btn",Ct),S("settings-trigger",So),S("logout-btn",bt),S("mobile-logout-btn",bt);const t=async()=>{u.settings.drivePath=document.getElementById("config-drive-path").value,u.settings.algo=document.getElementById("config-algo").value,await X(),T("‚úÖ Configuraci√≥n guardada"),Dt()};S("save-sync-config",t),S("save-security-config",t),S("connect-drive-btn",wo),S("theme-light",()=>Vt("light")),S("theme-dark",()=>Vt("dark")),document.querySelectorAll(".nav-link[data-view], .nav-link-mobile[data-view], .nav-link-mobile-drawer[data-view]").forEach(n=>{n.onclick=()=>{const o=n.dataset.view;at(o,o==="all"?"Todas las notas":""),Bt()}}),S("sidebar-manage-cats",Wt),S("mobile-manage-cats",()=>{Bt(),Wt()}),S("add-cat-btn",xo);const e=n=>{const o=n.target.closest("#settings-modal, #categories-modal, #editor-modal");o&&o.classList.add("hidden")};document.querySelectorAll(".close-modal, .close-settings, .close-categories").forEach(n=>{n.onclick=e}),document.body.addEventListener("click",n=>{const o=n.target.closest(".toggle-pass");if(!o)return;const i=document.getElementById(o.dataset.target);if(!i)return;const a=i.type==="password";i.type=a?"text":"password";const r=o.querySelector("[data-lucide]");r&&(r.setAttribute("data-lucide",a?"eye-off":"eye"),K())}),S("auth-submit",()=>_n(we)),S("factory-reset",()=>{confirm("‚ö†Ô∏è ¬øBORRAR TODO? Esto eliminar√° todas las notas guardadas en este navegador localmente.")&&(localStorage.clear(),sessionStorage.clear(),location.reload())}),window.triggerAutoSync=Dt,window.handleLogout=bt,window.openEditor=Ne}function mo(){const t=o=>{const i=o.target.value.toLowerCase();document.querySelectorAll(".note-card").forEach(r=>{const s=u.notes.find(d=>d.id===r.dataset.id);if(!s)return;const l=s.title.toLowerCase().includes(i)||s.content.toLowerCase().includes(i);r.classList.toggle("hidden",!l)})},e=document.getElementById("search-input"),n=document.getElementById("mobile-search-input-top");e&&(e.oninput=t),n&&(n.oninput=t)}function ho(){const t=document.getElementById("mobile-sidebar-overlay");S("mobile-sidebar-trigger",()=>{t==null||t.classList.remove("hidden"),St(at,u.categories)}),S("close-mobile-sidebar",Bt),S("mobile-menu-trigger",()=>{t==null||t.classList.remove("hidden"),St(at,u.categories)});const e=document.getElementById("mobile-search-bar"),n=document.getElementById("mobile-search-input-top");S("mobile-search-btn",()=>{e==null||e.classList.remove("hidden"),n==null||n.focus()}),S("close-mobile-search",()=>{e&&e.classList.add("hidden"),n&&(n.value="",n.dispatchEvent(new Event("input")))}),S("mobile-search-trigger",()=>{e==null||e.classList.remove("hidden"),n==null||n.focus()})}function vo(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(e=>{console.log("SW registrado corectamente:",e.scope)}).catch(e=>{console.log("Fallo al registrar SW:",e)})})}function bo(){window.addEventListener("beforeinstallprompt",e=>{var n,o;e.preventDefault(),ke=e,(n=document.getElementById("pwa-install-btn"))==null||n.classList.remove("hidden"),(o=document.getElementById("sidebar-pwa-install-btn"))==null||o.classList.remove("hidden")});const t=async()=>{var n,o;if(!ke)return;ke.prompt();const{outcome:e}=await ke.userChoice;e==="accepted"&&((n=document.getElementById("pwa-install-btn"))==null||n.classList.add("hidden"),(o=document.getElementById("sidebar-pwa-install-btn"))==null||o.classList.add("hidden")),ke=null};S("pwa-install-btn",t),S("sidebar-pwa-install-btn",t)}function yo(){const t=setInterval(()=>{typeof gapi<"u"&&typeof google<"u"&&(clearInterval(t),gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),u.gapiLoaded=!0,u.tokenClient=google.accounts.oauth2.initTokenClient({client_id:fo,scope:"https://www.googleapis.com/auth/drive.file",callback:n=>{if(n.error)return T("‚ùå Error de vinculaci√≥n");localStorage.setItem("gdrive_token_v3",JSON.stringify(n)),vt(!0),T("‚úÖ Vinculado con Google Drive")}});const e=localStorage.getItem("gdrive_token_v3");if(e){const n=JSON.parse(e);gapi.client.setToken(n),vt(!0)}else vt(!1)}))},500)}function wo(){if(!u.tokenClient)return T("Google API no lista");u.tokenClient.requestAccessToken({prompt:"consent"})}function vt(t){const e=document.getElementById("drive-status"),n=document.getElementById("sync-btn");e&&(e.innerHTML=t?'<span class="flex items-center gap-2 text-green-500 font-bold"><i data-lucide="check-circle" class="w-4 h-4"></i> Conectado</span>':'<span class="flex items-center gap-2 text-muted-foreground font-bold font-mono uppercase"><i data-lucide="x-circle" class="w-4 h-4"></i> No conectado</span>',e.className=t?"text-[10px] px-2 py-0.5 rounded-full bg-primary/10 text-primary":"text-[10px] px-2 py-0.5 rounded-full bg-muted text-muted-foreground"),n&&(n.style.opacity=t?"1":"0.3",n.style.pointerEvents=t?"auto":"none"),K()}async function Ct(){const t=sessionStorage.getItem("cn_pass_plain_v3");if(!t)return;const e=document.getElementById("sync-icon"),n=document.getElementById("sync-btn");e&&e.classList.add("animate-spin"),n&&n.classList.add("text-primary");try{const o=new xn("notev3_",u.settings.drivePath),i=await o.getOrCreateFolder(u.settings.drivePath),a=await F.encrypt({notes:u.notes,categories:u.categories},t);await o.saveChunks(a,i),T("‚úÖ Sincronizaci√≥n completada")}catch(o){console.error("Sync error:",o),T("‚ùå Error en la sincronizaci√≥n")}finally{e&&e.classList.remove("animate-spin"),n&&n.classList.remove("text-primary")}}function Dt(){const t=localStorage.getItem("gdrive_token_v3");u.gapiLoaded&&t&&sessionStorage.getItem("cn_pass_plain_v3")&&Ct()}function Wt(){const t=document.getElementById("categories-modal");t&&(t.classList.remove("hidden"),$e(we,u.categories))}function Bt(){const t=document.getElementById("mobile-sidebar-overlay");t&&t.classList.add("hidden")}async function xo(){const t=document.getElementById("new-cat-name"),e=t==null?void 0:t.value.trim();e&&(u.categories.push({id:"cat_"+Date.now(),name:e,color:"#aecbfa",passwordHash:null}),await X(),t&&(t.value=""),$e(we,u.categories),we(),Dt())}function bt(){localStorage.removeItem("cn_pass_plain_v3"),sessionStorage.removeItem("cn_pass_plain_v3"),location.reload()}function Eo(){const t=document.getElementById("app-version");t&&(t.innerText=bn)}function So(){const t=document.getElementById("settings-modal");if(t){t.classList.remove("hidden"),document.getElementById("config-drive-path").value=u.settings.drivePath,document.getElementById("config-algo").value=u.settings.algo;const e=t.querySelector('.settings-tab[data-tab="appearance"]');e&&e.click()}}function Vt(t){u.settings.theme=t,gn(),X()}
