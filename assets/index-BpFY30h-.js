(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const N="974464877836-721dprai6taijtuufmrkh438q68e97sp.apps.googleusercontent.com",B="https://www.googleapis.com/auth/drive.file",C="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",E="cloud_notes_db.json";let c=JSON.parse(localStorage.getItem("cloud_notes")||"[]"),L,T=!1;const v=document.getElementById("notes-grid"),d=document.getElementById("note-title"),l=document.getElementById("note-content"),w=document.getElementById("note-actions"),O=document.getElementById("save-note"),b=document.getElementById("sync-btn"),m=document.getElementById("auth-btn"),A=document.getElementById("status-bar"),k=document.getElementById("status-text");document.addEventListener("DOMContentLoaded",()=>{u(),_(),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>console.log("SW Registered",e)).catch(e=>console.log("SW Error",e))});function _(){l.addEventListener("focus",()=>{d.classList.remove("hidden"),w.classList.remove("hidden")}),document.addEventListener("click",e=>{!document.querySelector(".note-input-card").contains(e.target)&&l.value===""&&d.value===""&&(d.classList.add("hidden"),w.classList.add("hidden"))}),O.addEventListener("click",P),b.addEventListener("click",I),m.addEventListener("click",S),x(),D()}function x(){gapi.load("client",async()=>{await gapi.client.init({discoveryDocs:[C]}),T=!0})}function D(){L=google.accounts.oauth2.initTokenClient({client_id:N,scope:B,callback:async e=>{if(e.error!==void 0)throw e;g("Conectado con Google"),m.querySelector(".text").innerText="Conectado",m.classList.add("connected"),await I()}})}async function S(){L.requestAccessToken({prompt:""})}function u(){v.innerHTML="",c.sort((e,t)=>t.updatedAt-e.updatedAt).forEach(e=>{const t=document.createElement("div");t.className="note-card",t.innerHTML=`
            <button class="delete-btn" onclick="deleteNote('${e.id}')">✕</button>
            <h3>${e.title||""}</h3>
            <p>${e.content}</p>
        `,v.appendChild(t)})}function P(){const e=d.value.trim(),t=l.value.trim();if(!t&&!e)return;const i={id:Date.now().toString(),title:e,content:t,updatedAt:Date.now()};c.unshift(i),h(),u(),d.value="",l.value=""}function q(e){c=c.filter(t=>t.id!==e),h(),u()}function h(){localStorage.setItem("cloud_notes",JSON.stringify(c))}async function I(){if(!T)return g("Google API no cargada");p("Sincronizando...");try{const t=(await gapi.client.drive.files.list({q:`name = '${E}' and trashed = false`,fields:"files(id, name)"})).result.files;let i=t.length>0?t[0].id:null;if(i){const n=(await gapi.client.drive.files.get({fileId:i,alt:"media"})).result,o=[...c];n.forEach(s=>{const a=o.findIndex(f=>f.id===s.id);a===-1?o.push(s):s.updatedAt>o[a].updatedAt&&(o[a]=s)}),c=o,h(),u()}await z(i),p("Sincronizado"),g("Notas sincronizadas con éxito")}catch(e){console.error("Sync error:",e),p("Error al sincronizar"),e.status===401&&S()}}async function z(e){var i;const t=(i=gapi.auth.getToken())==null?void 0:i.access_token;if(!t)throw{status:401,message:"No access token"};if(e){const r=await fetch(`https://www.googleapis.com/upload/drive/v3/files/${e}?uploadType=media`,{method:"PATCH",headers:new Headers({Authorization:"Bearer "+t}),body:JSON.stringify(c)});if(!r.ok)throw new Error("Update failed");return r}else{const r="-------314159265358979323846",n=`\r
--`+r+`\r
`,o=`\r
--`+r+"--",s="application/json",a={name:E,mimeType:s},f=n+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(a)+n+"Content-Type: "+s+`\r
\r
`+JSON.stringify(c)+o,y=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:"Bearer "+t,"Content-Type":"multipart/related; boundary="+r}),body:f});if(!y.ok)throw new Error("Creation failed");return y}}function g(e){const t=document.getElementById("toast");t.innerText=e,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),3e3)}function p(e){A.classList.remove("hidden"),k.innerText=e}window.deleteNote=q;
